<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jalsa</title>
    
    <!-- Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Rubik:wght@500;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --anim-dur: 0.3s;
        }

        /* === DARK MODE (Default) === */
        [data-mode="dark"] {
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            --border-color: #333333;
            --accent: #ffffff;
            --card-bg: #252525;
            --btn-bg: #333333;
            --btn-text: #ffffff;
        }

        /* === LIGHT MODE === */
        [data-mode="light"] {
            --bg-color: #f4f4f4;
            --panel-bg: #ffffff;
            --text-main: #000000;
            --text-sub: #666666;
            --border-color: #dddddd;
            --accent: #000000;
            --card-bg: #ffffff;
            --btn-bg: #eeeeee;
            --btn-text: #000000;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Rubik', sans-serif;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
            transition: background-color 0.3s, color 0.3s;
        }

        .ar-font { font-family: 'Cairo', sans-serif; }

        /* SCREENS */
        .screen { display: none; height: 100vh; flex-direction: column; overflow-y: auto; position: relative; z-index: 10; }
        .screen.active { display: flex !important; animation: fadeIn 0.4s; }

        /* --- BACKGROUND ANIMATION --- */
        .splash-bg { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
        .floating-card {
            position: absolute;
            width: 120px; height: 180px;
            background: var(--panel-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            opacity: 0.3;
            animation: floatUp 20s linear infinite;
        }
        .floating-card::after {
            content: ''; position: absolute; inset: 8px; 
            border: 2px dashed var(--border-color); border-radius: 8px;
        }

        .c1 { left: 10%; bottom: -200px; animation-delay: 0s; transform: rotate(15deg); }
        .c2 { left: 80%; bottom: -200px; animation-delay: 5s; transform: rotate(-10deg); }
        .c3 { left: 40%; bottom: -200px; animation-delay: 10s; transform: rotate(5deg); }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            20% { opacity: 0.4; }
            100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; }
        }

        /* --- UI COMPONENTS --- */
        
        .btn-solid {
            background: var(--accent); color: var(--bg-color);
            border: none; padding: 15px 50px;
            font-size: 1.2rem; font-weight: 900;
            border-radius: 12px;
            text-transform: uppercase;
            cursor: pointer; transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-solid:active { transform: scale(0.96); }

        .btn-icon { background: none; border: none; color: var(--text-main); font-size: 1.5rem; cursor: pointer; padding: 10px; }
        
        /* Mode Grid */
        .mode-card {
            background: var(--panel-bg);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            height: 130px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.2s;
        }
        .mode-card:active { transform: scale(0.96); border-color: var(--accent); }
        .mode-icon { font-size: 2.5rem; margin-bottom: 8px; }
        .mode-title { font-weight: 700; text-transform: uppercase; font-size: 1rem; color: var(--text-main); }

        /* Count Buttons */
        .count-btn {
            width: 70px; height: 70px; border-radius: 50%;
            background: var(--panel-bg); border: 2px solid var(--border-color);
            color: var(--text-main); font-size: 1.5rem; font-weight: 900;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.2s;
        }
        .count-btn.active {
            background: var(--accent); border-color: var(--accent); color: var(--bg-color);
            transform: scale(1.1);
        }

        /* --- GAMEPLAY CARD --- */
        .game-stage {
            flex-grow: 1; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; padding: 20px;
        }
        
        .main-card {
            width: 100%; max-width: 500px; min-height: 300px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 40px;
            text-align: center;
            transition: 0.3s;
        }
        /* Dashed Inner Outline */
        .main-card::after {
            content: ''; position: absolute; inset: 15px;
            border: 2px dashed var(--border-color);
            border-radius: 12px; pointer-events: none;
        }

        .card-content { z-index: 2; width: 100%; }
        
        .blur-box {
            background: var(--bg-color); border: 1px solid var(--border-color);
            border-radius: 10px; padding: 20px; margin-top: 20px;
            cursor: pointer; user-select: none;
        }
        .blur-text { filter: blur(8px); transition: 0.3s; }
        .blur-box.revealed .blur-text { filter: blur(0); }

        .spin-text { font-size: 2.5rem; font-weight: 900; color: var(--accent); }

        .top-nav { display: flex; justify-content: space-between; align-items: center; padding: 20px; width: 100%; }
        .progress-track { flex-grow: 1; height: 6px; background: var(--border-color); border-radius: 10px; margin: 0 20px; }
        .progress-bar { height: 100%; background: var(--accent); width: 0%; border-radius: 10px; transition: width 0.3s; }

        .bottom-bar { padding: 20px; width: 100%; text-align: center; }
        .btn-action {
            width: 100%; max-width: 400px; padding: 16px; border: 2px solid var(--text-main);
            background: transparent; color: var(--text-main);
            font-weight: 900; font-size: 1.1rem; text-transform: uppercase;
            border-radius: 12px; cursor: pointer; transition: 0.2s;
        }
        .btn-action:active { background: var(--text-main); color: var(--bg-color); }

        /* SETTINGS (Bottom Sheet) */
        .modal-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 5000; 
            display: none; align-items: flex-end; justify-content: center;
        }
        .modal-panel { 
            background: var(--panel-bg); width: 100%; max-width: 600px;
            border-radius: 25px 25px 0 0; padding: 30px; 
            color: var(--text-main); border-top: 1px solid var(--border-color);
            box-shadow: 0 -5px 30px rgba(0,0,0,0.2);
            animation: slideUp 0.3s;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .lang-btn { 
            flex: 1; padding: 10px; margin: 0 5px; border-radius: 8px; 
            border: 1px solid var(--border-color); background: transparent; 
            color: var(--text-main); cursor: pointer; transition: 0.2s; font-weight: bold;
        }
        .lang-btn.active { background: var(--text-main); color: var(--bg-color); border-color: var(--text-main); }

        /* Toggle */
        .toggle-switch {
            width: 50px; height: 26px; background: var(--border-color);
            border-radius: 20px; position: relative; cursor: pointer; transition: 0.3s;
        }
        .toggle-switch.active { background: var(--accent); }
        .toggle-knob {
            width: 20px; height: 20px; background: var(--bg-color); border-radius: 50%;
            position: absolute; top: 3px; left: 3px; transition: 0.3s;
        }
        .toggle-switch.active .toggle-knob { left: 27px; }

        /* --- DIALOGS (FIXED CENTERING) --- */
        .dialog-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 6000;
            display: none; /* JS will toggle flex */
            align-items: center; justify-content: center;
        }
        .dialog-box {
            background: var(--panel-bg); border: 1px solid var(--border-color);
            padding: 30px; border-radius: 20px; text-align: center;
            color: var(--text-main); width: 300px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .dialog-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin: 0 5px; }
        .btn-yes { background: #e74c3c; color: white; }
        .btn-no { background: var(--border-color); color: var(--text-main); }

        .text-sub { color: var(--text-sub); font-size: 0.9rem; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }
    </style>
</head>
<body data-mode="dark">

    <!-- SPLASH BG -->
    <div class="splash-bg">
        <div class="floating-card c1"></div>
        <div class="floating-card c2"></div>
        <div class="floating-card c3"></div>
    </div>

    <!-- 1. LANDING -->
    <div id="screen-landing" class="screen active">
        <div class="d-flex flex-column justify-content-center align-items-center flex-grow-1" style="z-index: 2;">
            <h1 class="display-1 fw-bold mb-0 animate__animated animate__fadeInDown">JALSA</h1>
            <p class="text-sub mb-5 animate__animated animate__fadeInUp">The Social Hub</p>
            <button class="btn-solid animate__animated animate__pulse animate__infinite" onclick="enterApp()">
                Tap to Start
            </button>
        </div>
        <div class="text-center pb-4 text-sub" style="font-size: 0.7rem; z-index: 2;">
            Developed by <a href="https://mfouadbakr.github.io/portfolio/index.html" target="_blank" style="color: var(--accent); text-decoration: none;">Mohamed Bakr</a>
        </div>
    </div>

    <!-- 2. MODE SELECTION -->
    <div id="screen-modes" class="screen justify-content-center pt-5">
        <div class="container" style="max-width: 600px;">
            <div class="d-flex justify-content-between align-items-center mb-5 px-2">
                <button class="btn-icon" onclick="showScreen('screen-landing')">‚Üê</button>
                <h2 class="m-0 fw-bold" id="txt-title-mode">SELECT GAME</h2>
                <button class="btn-icon" onclick="toggleSettings()">‚öôÔ∏è</button>
            </div>

            <div class="row g-3">
                <div class="col-6"><div class="mode-card" onclick="prepareSetup('riddles')"><div class="mode-icon">üß©</div><div class="mode-title" id="mode-riddles">Riddles</div></div></div>
                <div class="col-6"><div class="mode-card" onclick="prepareSetup('challenge')"><div class="mode-icon">üé°</div><div class="mode-title" id="mode-challenge">Challenge</div></div></div>
                <div class="col-6"><div class="mode-card" onclick="prepareSetup('drawing')"><div class="mode-icon">üé®</div><div class="mode-title" id="mode-drawing">Drawing</div></div></div>
                <div class="col-6"><div class="mode-card" onclick="prepareSetup('acting')"><div class="mode-icon">üé≠</div><div class="mode-title" id="mode-acting">Acting</div></div></div>
            </div>
        </div>
    </div>

    <!-- 3. SETUP (COUNT) -->
    <div id="screen-setup" class="screen justify-content-center align-items-center">
        <div class="container text-center" style="max-width: 500px;">
            <h2 class="fw-bold mb-5" id="txt-how-many">ROUNDS</h2>
            
            <div class="d-flex justify-content-center gap-4 mb-5">
                <div class="count-btn" onclick="setCount(10)">10</div>
                <div class="count-btn active" id="btn-c-20" onclick="setCount(20)">20</div>
                <div class="count-btn" onclick="setCount(30)">30</div>
            </div>

            <button class="btn-solid w-100" onclick="startGame()">PLAY</button>
            <div class="mt-3">
                <button class="btn" style="color: var(--text-sub);" onclick="showScreen('screen-modes')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- 4. GAMEPLAY -->
    <div id="screen-game" class="screen">
        <!-- Top -->
        <div class="top-nav">
            <button class="btn-icon" onclick="confirmExit()">‚úï</button>
            <div class="progress-track"><div class="progress-bar" id="progress-bar"></div></div>
            <div style="font-weight:900" id="counter">1/20</div>
        </div>

        <!-- Stage -->
        <div class="game-stage">
            <div id="game-card" class="main-card animate__animated">
                <!-- Content injected here -->
                <div class="card-content" id="card-content"></div>
            </div>
        </div>

        <!-- Bottom -->
        <div class="bottom-bar">
            <button class="btn-action" id="btn-next" onclick="nextCard()">Next Card</button>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div class="modal-overlay" id="settings-modal" onclick="if(event.target === this) toggleSettings()">
        <div class="modal-panel">
            <div class="d-flex justify-content-between mb-4">
                <h4 class="m-0 fw-bold" id="lbl-settings">SETTINGS</h4>
                <button onclick="toggleSettings()" class="btn-icon" style="font-size:1rem;">‚úï</button>
            </div>

            <!-- Mode -->
            <div class="setting-row">
                <span id="lbl-dark">Dark Mode</span>
                <div class="toggle-switch active" id="modeSwitch" onclick="toggleMode()">
                    <div class="toggle-knob"></div>
                </div>
            </div>

            <!-- Language -->
            <label class="text-sub d-block mb-2" id="lbl-lang">Language</label>
            <div class="d-flex">
                <button class="lang-btn active" id="btn-lang-en" onclick="setLang('en')">English</button>
                <button class="lang-btn" id="btn-lang-ar" onclick="setLang('ar')">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
            </div>
        </div>
    </div>

    <!-- DIALOG -->
    <div id="custom-dialog" class="dialog-overlay">
        <div class="dialog-box animate__animated animate__zoomIn">
            <h3 class="fw-bold mb-3" id="d-title">Exit?</h3>
            <p class="text-sub mb-4" id="d-msg" style="text-transform: none;">Progress will be lost.</p>
            <div class="d-flex gap-2">
                <button class="dialog-btn btn-no" onclick="$('#custom-dialog').fadeOut()">No</button>
                <button class="dialog-btn btn-yes" onclick="performExit()">Yes</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // --- DATA ---
        const db = {
            riddles: [
                {q: "ÿ≠ÿßÿ¨ÿ© ÿ®ÿ™ŸÖÿ¥Ÿä ŸÖŸÜ ÿ∫Ÿäÿ± ÿ±ÿ¨ŸÑŸäŸÜ Ÿàÿ®ÿ™ÿπŸäÿ∑ ŸÖŸÜ ÿ∫Ÿäÿ± ÿπŸäŸàŸÜÿü", a: "ÿßŸÑÿ≥ÿ≠ÿßÿ®"}, {q: "ÿßÿ®ŸÜ ÿ£ŸÖŸÉ Ÿàÿ£ÿ®ŸàŸÉÿå ŸàŸÖÿ¥ ÿ£ÿÆÿ™ŸÉ ŸàŸÑÿß ÿ£ÿÆŸàŸÉÿå ŸÖŸäŸÜ ŸáŸàÿü", a: "ÿ£ŸÜÿ™"},
                {q: "ÿ≠ÿßÿ¨ÿ© ÿ®ÿ™ÿ¥ŸäŸÑŸáÿß ŸàŸáŸä ÿ¥ÿßŸäŸÑŸÉÿü", a: "ÿßŸÑÿ≠ÿ∞ÿßÿ°"}, {q: "ÿ≠ÿßÿ¨ÿ© ŸÉŸÑ ŸÖÿß ÿ™ÿßÿÆÿØ ŸÖŸÜŸáÿß ÿ™ŸÉÿ®ÿ±ÿü", a: "ÿßŸÑÿ≠ŸÅÿ±ÿ©"},
                {q: "ÿßŸäŸá ÿßŸÑŸÑŸä ÿ®ŸäÿπÿØŸä ÿßŸÑÿ®ÿ≠ÿ± ŸàŸÖÿ¥ ÿ®Ÿäÿ™ÿ®ŸÑÿü", a: "ÿßŸÑÿ∑Ÿäÿßÿ±ÿ©"}, {q: "ÿπŸÜÿØŸá ÿ≥ŸÜÿßŸÜ ÿ®ÿ≥ ŸÖÿ®Ÿäÿπÿ∂ÿ¥ÿü", a: "ÿßŸÑŸÖÿ¥ÿ∑"},
                {q: "ÿ®Ÿäÿ≥ŸÖÿπ ÿ®ŸÑÿß ÿ£ÿ∞ŸÜ Ÿàÿ®Ÿäÿ™ŸÉŸÑŸÖ ÿ®ŸÑÿß ŸÑÿ≥ÿßŸÜÿü", a: "ÿßŸÑÿ™ŸÑŸäŸÅŸàŸÜ"}, {q: "ÿ≠ÿßÿ¨ÿ© ÿ®ÿ™ÿ¥ŸàŸÅ ŸÉŸÑ ÿ≠ÿßÿ¨ÿ© ŸàŸÖÿπŸÜÿØŸáÿßÿ¥ ÿπŸäŸàŸÜÿü", a: "ÿßŸÑŸÖÿ±ÿßŸäÿ©"},
                {q: "ÿ®ŸäŸÖÿ¥Ÿä Ÿàÿ®ŸäŸÇŸäŸÅ ŸàŸÖŸÑŸàÿ¥ ÿ±ÿ¨ŸÑŸäŸÜÿü", a: "ÿßŸÑÿ≥ÿßÿπÿ©"}, {q: "ÿ£ŸáŸàŸÜ ŸÖŸàÿ¨ŸàÿØ Ÿàÿ£ÿπÿ≤ ŸÖŸÅŸÇŸàÿØÿü", a: "ÿßŸÑŸÖÿßÿ°"},
                {q: "ÿÆÿßŸÑŸÉ ŸáŸà ÿ£ÿÆŸà ÿπŸÖŸÉÿü", a: "ŸÑÿ£ÿå ÿ£ÿ®ŸàŸÉ"}, {q: "ÿ¥Ÿäÿ° ÿ™ÿ∞ÿ®ÿ≠Ÿá Ÿàÿ™ÿ®ŸÉŸä ÿπŸÑŸäŸáÿü", a: "ÿßŸÑÿ®ÿµŸÑ"},
                {q: "ÿ®Ÿäÿ™ ŸÖŸÑŸàÿ¥ ŸÑÿß ÿ®ÿßÿ® ŸàŸÑÿß ÿ¥ÿ®ÿßŸÉÿü", a: "ÿ®Ÿäÿ™ ÿßŸÑÿ¥ÿπÿ±"}, {q: "ÿ≠ÿßÿ¨ÿ© ÿ®ÿ™ÿØÿÆŸÑ ŸÖÿ®ŸÑŸàŸÑÿ© Ÿàÿ™ÿÆÿ±ÿ¨ ŸÜÿßÿ¥ŸÅÿ©ÿü", a: "ÿßŸÑÿπŸäÿ¥"},
                {q: "ÿßŸäŸá ÿßŸÑŸÑŸä ŸÉŸÑ ŸÖÿß Ÿäÿ≤ŸäÿØ ŸäŸÜŸÇÿµÿü", a: "ÿßŸÑÿπŸÖÿ±"}, {q: "ÿ≠ÿßÿ¨ÿ© ŸÑŸäŸáÿß ÿ±ÿ¨ŸÑ Ÿàÿ≠ÿØÿ© Ÿà 3 ÿπŸäŸàŸÜÿü", a: "ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"},
                {q: "ÿ®ŸäŸÇÿ±ÿµŸÉ ŸàŸÖÿ¥ ÿ®ÿ™ÿ¥ŸàŸÅŸáÿü", a: "ÿßŸÑÿ¨Ÿàÿπ"}, {q: "ÿ≠ÿßÿ¨ÿ© ÿ®ÿ™ŸÉÿ™ÿ® ŸàŸÖÿ¥ ÿ®ÿ™ŸÇÿ±ÿ£ÿü", a: "ÿßŸÑŸÇŸÑŸÖ"},
                {q: "ÿ≠ÿßÿ¨ÿ© ÿ®ÿ™ÿ∑Ÿäÿ± ŸÖŸÜ ÿ∫Ÿäÿ± ÿ¨ŸÜÿßÿ≠ŸäŸÜÿü", a: "ÿßŸÑŸàŸÇÿ™"}, {q: "ÿßŸäŸá ÿßŸÑÿ≠ÿßÿ¨ÿ© ÿßŸÑŸÑŸä ŸÉŸÑ ŸÖÿß ÿ™ÿØŸäŸáÿß ÿ™ÿ≤ŸäÿØÿü", a: "ÿßŸÑÿ≠ÿ® / ÿßŸÑÿπŸÑŸÖ"}
            ],
            challenge: [
                "ÿßÿ™ŸÉŸÑŸÖ ÿ≤Ÿä ÿßŸÑŸÖÿπŸÑŸÇŸäŸÜ ÿßŸÑÿ±Ÿäÿßÿ∂ŸäŸäŸÜ ŸÑŸÖÿØÿ© ÿØŸÇŸäŸÇÿ©", "ÿßÿπŸÖŸÑ 10 ÿ∂ÿ∫ÿ∑ ÿØŸÑŸàŸÇÿ™Ÿä ÿ≠ÿßŸÑÿß", "ŸÇŸàŸÑ ŸÜŸÉÿ™ÿ© ÿ®ÿßŸäÿÆÿ© ŸàŸÖÿ≠ÿØÿ¥ Ÿäÿ∂ÿ≠ŸÉ",
                "ÿßŸÖÿ¥Ÿä ŸÖÿ¥Ÿäÿ© ÿßŸÑÿ®ÿ∑ÿ±ŸäŸÇ ŸÑÿ≠ÿØ ÿ®ÿßÿ® ÿßŸÑÿ£Ÿàÿ∂ÿ© Ÿàÿßÿ±ÿ¨ÿπ", "ÿ≥Ÿäÿ® ŸÖŸàÿ®ÿßŸäŸÑŸÉ ŸÖŸÅÿ™Ÿàÿ≠ ŸÖÿπ ÿßŸÑŸÑŸä ÿ¨ŸÜÿ®ŸÉ ÿØŸÇŸäŸÇÿ©", "ÿ∫ŸÜŸä ÿ£ÿ∫ŸÜŸäÿ© ÿ¥ÿπÿ®Ÿä ÿ®ÿµŸàÿ™ ÿ£Ÿàÿ®ÿ±ÿß",
                "ÿßŸÇŸÅ ÿπŸÑŸâ ÿ±ÿ¨ŸÑ Ÿàÿßÿ≠ÿØÿ© ŸÑÿ∫ÿßŸäÿ© ÿßŸÑÿØŸàÿ± ŸÖÿß Ÿäÿ¨ŸäŸÑŸÉ ÿ™ÿßŸÜŸä", "ÿßÿ™ÿµŸÑ ÿ®ÿ≠ÿØ ŸàŸÇŸàŸÑŸá 'ÿ£ŸÜÿß ÿ®ÿ≠ÿ® ÿßŸÑŸÖŸÑŸàÿÆŸäÿ©' ŸàÿßŸÇŸÅŸÑ", "ÿßÿπŸÖŸÑ ŸÜŸÅÿ≥ŸÉ ÿ™ŸÖÿ´ÿßŸÑ ŸàŸÖÿ™ÿ≠ÿ±ŸÉÿ¥ ŸÑŸÖÿØÿ© ÿØŸÇŸäŸÇÿ©",
                "ŸÇŸàŸÑ 'ÿ∑ÿ®ŸÇ ÿ∑ÿ®ŸÇŸÜÿß' 5 ŸÖÿ±ÿßÿ™ ÿ®ÿ≥ÿ±ÿπÿ©", "ŸÇŸàŸÖ Ÿáÿßÿ™ ŸÖŸäÿ© ŸÑÿ£ŸÉÿ®ÿ± Ÿàÿßÿ≠ÿØ ŸÅŸä ÿßŸÑŸÇÿπÿØÿ©", "ÿ®Ÿàÿ≥ ÿ±ÿßÿ≥ ŸàÿßŸÑÿØŸÉ ÿ£Ÿà ŸàÿßŸÑÿØÿ™ŸÉ ÿ£Ÿà ÿ¥ÿ±ŸäŸÉŸÉ",
                "ŸÇŸàŸÑ ÿµŸÅÿ© ÿ≠ŸÑŸàÿ© ŸÅŸä ŸÉŸÑ Ÿàÿßÿ≠ÿØ ŸÇÿßÿπÿØ", "ŸÖŸÖŸÜŸàÿπ ÿ™ÿ™ŸÉŸÑŸÖ ŸÑŸÖÿØÿ© ÿØŸÇŸäŸÇÿ© (ÿ•ÿ¥ÿßÿ±ÿ© ÿ®ÿ≥)", "ÿßÿ≠ŸÉŸä ŸÖŸàŸÇŸÅ ŸÖÿ∂ÿ≠ŸÉ ÿ≠ÿµŸÑŸÉ ŸàÿßŸÜÿ™ ÿµÿ∫Ÿäÿ±",
                "ŸÇŸàŸÑ 3 ÿ£ŸÖÿ´ÿßŸÑ ÿ¥ÿπÿ®Ÿäÿ© ÿ®ÿ≥ÿ±ÿπÿ©", "ÿßÿπŸÖŸÑ ŸÖÿ≥ÿßÿ¨ ŸÑŸÑŸä ÿ¨ŸÜÿ®ŸÉ", "ÿßÿ∂ÿ≠ŸÉ ÿ∂ÿ≠ŸÉÿ© ÿ¥ÿ±Ÿäÿ±ÿ© ÿ®ÿµŸàÿ™ ÿπÿßŸÑŸä",
                "ŸÇŸàŸÑ ÿßÿ≥ŸÖŸÉ ÿ®ÿßŸÑŸÖÿ™ÿ¥ŸÇŸÑÿ®", "ÿ∫ŸÖÿ∂ ÿπŸäŸÜŸÉ Ÿàÿ≠ÿßŸàŸÑ ÿ™ŸÑŸÖÿ≥ ŸÖŸÜÿßÿÆŸäÿ±ŸÉ", "ÿßÿπŸÖŸÑ ÿµŸàÿ™ ŸÇÿ∑ÿ© ÿ¨ÿπÿßŸÜÿ©",
                "ÿßÿ™ŸÉŸÑŸÖ ÿ®ŸÑŸáÿ¨ÿ© ÿÆŸÑŸäÿ¨Ÿä ŸÑŸÖÿØÿ© ÿØŸÇŸäŸÇÿ©", "ÿ≠ÿßŸàŸÑ ÿ™ŸÑÿ≠ÿ≥ ŸÉŸàÿπŸÉ", "ŸÇŸàŸÑ ÿ≠ÿ±ŸàŸÅ ÿßÿ≥ŸÖŸÉ ŸÖŸÜ ÿßŸÑÿ¢ÿÆÿ± ŸÑŸÑÿ£ŸàŸÑ",
                "ÿßÿπŸÖŸÑ ÿ≤Ÿä ÿßŸÑŸÅÿ±ÿÆÿ© ŸàŸáŸä ÿ®ÿ™ÿ®Ÿäÿ∂", "ÿßÿπŸÖŸÑ ŸÜŸÅÿ≥ŸÉ ÿ®ÿ™ÿπŸàŸÖ ÿπŸÑŸâ ÿßŸÑÿ£ÿ±ÿ∂", "ŸÇŸàŸÑ ŸÜŸÉÿ™ÿ© ŸàŸÑŸà ŸÖÿ≠ÿØÿ¥ ÿ∂ÿ≠ŸÉ ÿßÿπŸÖŸÑ 5 ÿ∂ÿ∫ÿ∑",
                "ÿßÿ±ÿ≥ŸÖ ÿ¥ŸÜÿ® ÿ®ÿßŸÑŸÉÿ≠ŸÑ (ŸÑŸà ÿ®ŸÜÿ™) ÿ£Ÿà ÿ±Ÿàÿ¨ (ŸÑŸà ŸàŸÑÿØ)", "ÿßÿπŸÖŸÑ ÿ≠ÿ±ŸÉÿ© ÿ≥ŸÑŸà ŸÖŸàÿ¥ŸÜ ŸÑŸÖÿØÿ© ÿØŸÇŸäŸÇÿ©", "ÿßŸÇÿ±ÿ£ ÿ¢ÿÆÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ¨ÿßÿ™ŸÑŸÉ ÿ®ÿµŸàÿ™ ÿπÿßŸÑŸä"
            ],
            drawing: [
                "ÿßÿ±ÿ≥ŸÖ: ÿ®ÿ∑ŸäÿÆÿ© ŸÑÿßÿ®ÿ≥ÿ© ŸÜÿ∂ÿßÿ±ÿ©", "ÿßÿ±ÿ≥ŸÖ: ÿ¨ŸÖŸÑ ÿ®ŸäŸÑÿπÿ® ŸÉŸàÿ±ÿ©", "ÿßÿ±ÿ≥ŸÖ: ÿ≥ŸÖŸÉÿ© ÿ®ÿ™ÿ∑Ÿäÿ±", "ÿßÿ±ÿ≥ŸÖ: ÿ¥ÿ®ÿ¥ÿ® ÿ®Ÿäÿ∂ÿ≠ŸÉ",
                "ÿßÿ±ÿ≥ŸÖ: ÿ®Ÿäÿ™ÿ≤ÿß ÿπŸÑŸäŸáÿß ÿ£ŸÜÿßŸÜÿßÿ≥", "ÿßÿ±ÿ≥ŸÖ: ŸÅÿ∂ÿßÿ¶Ÿä ÿ®Ÿäÿ¥ÿ±ÿ® ÿ¥Ÿäÿ¥ÿ©", "ÿßÿ±ÿ≥ŸÖ: ÿπÿ±ÿ®Ÿäÿ© ŸÖÿ±ÿ®ÿπÿ©", "ÿßÿ±ÿ≥ŸÖ: ŸÖŸàÿ®ÿßŸäŸÑ ŸÇÿØŸäŸÖ",
                "ÿßÿ±ÿ≥ŸÖ: ÿπŸÜŸÉÿ®Ÿàÿ™ ŸÑÿßÿ®ÿ≥ ŸÉŸàÿ™ÿ¥Ÿä", "ÿßÿ±ÿ≥ŸÖ: ÿ¥ÿ¨ÿ±ÿ© ŸÅŸä ÿßŸÑÿÆÿ±ŸäŸÅ", "ÿßÿ±ÿ≥ŸÖ: ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿπŸäŸÑÿ©", "ÿßÿ±ÿ≥ŸÖ: ÿßŸÑÿ£ŸÉŸÑ ÿßŸÑŸÖŸÅÿ∂ŸÑ ŸÑŸäŸÉ",
                "ÿßÿ±ÿ≥ŸÖ: ÿ®Ÿäÿ™ ÿ£ÿ≠ŸÑÿßŸÖŸÉ", "ÿßÿ±ÿ≥ŸÖ: ŸÇÿ∑ÿ© ÿ®ÿ™ŸÑÿπÿ®", "ÿßÿ±ÿ≥ŸÖ: ŸÅÿßŸÜŸàÿ≥ ÿ±ŸÖÿ∂ÿßŸÜ", "ÿßÿ±ÿ≥ŸÖ: ÿ®ÿ≠ÿ± Ÿàÿ¥ŸÖÿ≥",
                "ÿßÿ±ÿ≥ŸÖ: ÿ™Ÿàÿ±ÿ∑ÿ© ÿπŸäÿØ ŸÖŸäŸÑÿßÿØ", "ÿßÿ±ÿ≥ŸÖ: ÿπÿ±ÿ®Ÿäÿ© ÿßŸÑÿπŸäŸÑÿ©", "ÿßÿ±ÿ≥ŸÖ: ŸÉŸàÿ®ÿßŸäÿ© ÿ¥ÿßŸä", "ÿßÿ±ÿ≥ŸÖ: Ÿàÿ±ÿØÿ© ÿ®ÿ™ÿ∂ÿ≠ŸÉ",
                "ÿßÿ±ÿ≥ŸÖ: ŸÇŸÑÿ® ÿ®Ÿäÿ∑Ÿäÿ±", "ÿßÿ±ÿ≥ŸÖ: ÿØÿ®ŸÑÿ© ŸàŸÖÿ≠ÿ®ÿ≥", "ÿßÿ±ÿ≥ŸÖ: ÿØŸäŸÜÿßÿµŸàÿ± ÿ®ŸäÿßŸÉŸÑ ÿ¢Ÿäÿ≥ ŸÉÿ±ŸäŸÖ", "ÿßÿ±ÿ≥ŸÖ: ÿ¥ŸÖÿ≥ ŸÑÿßÿ®ÿ≥ÿ© ÿ∑ÿßŸÇŸäÿ©",
                "ÿßÿ±ÿ≥ŸÖ: ŸÅŸäŸÑ ÿ®Ÿäÿ±ŸÇÿµ ÿ®ÿßŸÑŸäŸá", "ÿßÿ±ÿ≥ŸÖ: ÿ®ÿ∑ÿ© ŸÑÿßÿ®ÿ≥ÿ© ÿ®ÿØŸÑÿ©", "ÿßÿ±ÿ≥ŸÖ: ÿ≥ÿßŸÜÿØŸàÿ™ÿ¥ ÿ∑ÿπŸÖŸäÿ©", "ÿßÿ±ÿ≥ŸÖ: ÿ£Ÿáÿ±ÿßŸÖÿßÿ™ ÿßŸÑÿ¨Ÿäÿ≤ÿ©",
                "ÿßÿ±ÿ≥ŸÖ: ÿ™ŸàŸÉ ÿ™ŸàŸÉ ÿ®Ÿäÿ∑Ÿäÿ±", "ÿßÿ±ÿ≥ŸÖ: ŸÉÿ®ÿßŸäÿ© ŸÇŸáŸàÿ© ÿ®ÿ™ÿπŸäÿ∑", "ÿßÿ±ÿ≥ŸÖ: ŸÖÿ±Ÿàÿ≠ÿ© ÿ≥ŸÇŸÅ", "ÿßÿ±ÿ≥ŸÖ: ŸÖŸäŸÉÿ±Ÿàÿ®ÿßÿµ ÿ≤ÿ≠ŸÖÿ©"
            ],
            acting: [
                "ŸÖÿ´ŸÑ: ÿ≥ŸàÿßŸÇ ŸÖŸäŸÉÿ±Ÿàÿ®ÿßÿµ ÿ®ŸäŸÑŸÖ ÿßŸÑÿ£ÿ¨ÿ±ÿ©", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ≠ÿßŸàŸÑ ŸäŸÇÿ™ŸÑ ŸÜÿßŸÖŸàÿ≥ÿ© ÿ±ÿÆŸÖÿ©", "ŸÖÿ´ŸÑ: ÿ≠ÿ±ÿßŸÖŸä ÿ∫ÿ®Ÿä ÿ®Ÿäÿ≠ÿßŸàŸÑ Ÿäÿ≥ÿ±ŸÇ ÿ®ŸÜŸÉ",
                "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®ŸäÿßŸÉŸÑ ŸÑŸäŸÖŸàŸÜÿ© ÿ≠ÿßŸÖÿ∂ÿ©", "ŸÖÿ´ŸÑ: ÿØŸÉÿ™Ÿàÿ± ÿ≥ŸÜÿßŸÜ ÿ®ŸäÿÆŸÑÿπ ÿ∂ÿ±ÿ≥ ŸÑŸàÿßÿ≠ÿØ ÿÆÿßŸäŸÅ", "ŸÖÿ´ŸÑ: ÿ≤ŸàŸÖÿ®Ÿä ÿ®Ÿäÿ¨ÿ±Ÿä Ÿàÿ±ÿß ÿßŸÑŸÜÿßÿ≥",
                "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ™ÿ≤ÿ≠ŸÑŸÇ ÿπŸÑŸâ ŸÇÿ¥ÿ±ÿ© ŸÖŸàÿ≤", "ŸÖÿ´ŸÑ: ÿ±Ÿàÿ®Ÿàÿ™ ÿ®ÿ∑ÿßÿ±Ÿäÿ™Ÿá ÿ®ÿ™ÿÆŸÑÿµ", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ¥ÿßŸäŸÑ ÿ≠ÿØŸäÿØ ÿ™ŸÇŸäŸÑ ÿ¨ÿØÿß",
                "ŸÖÿ´ŸÑ: ŸÜŸÖŸÑÿ© ÿ¥ÿßŸäŸÑÿ© ÿ≠ÿ®ÿßŸäÿ© ÿ≥ŸÉÿ±", "ŸÖÿ´ŸÑ: ÿ£ŸÖ ÿ®ÿ™ÿµÿ≠Ÿä ŸàŸÑÿßÿØŸáÿß ŸÑŸÑŸÖÿØÿ±ÿ≥ÿ©", "ŸÖÿ´ŸÑ: ÿ£ÿ® ÿ®ŸäÿµŸÑÿ≠ ÿßŸÑÿ™ŸÑŸÅÿ≤ŸäŸàŸÜ",
                "ŸÖÿ´ŸÑ: ÿ∑ŸÅŸÑ ÿ®ŸäÿπŸäÿ∑ ÿπÿ¥ÿßŸÜ ÿπÿßŸäÿ≤ ŸÑÿπÿ®ÿ©", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ∫ÿ≥ŸÑ ŸÖŸàÿßÿπŸäŸÜ", "ŸÖÿ´ŸÑ: ÿ¨ÿØŸà ŸàŸáŸà ÿ®ŸäŸÇÿ±ÿ£ ÿßŸÑÿ¨ÿ±ŸÜÿßŸÑ",
                "ŸÖÿ´ŸÑ: ÿ≠ÿØ ÿ®Ÿäÿ∑ÿ®ÿÆ ŸàÿßŸÑÿ£ŸÉŸÑ ÿßÿ™ÿ≠ÿ±ŸÇ", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ŸÜÿßŸäŸÖ Ÿàÿ®Ÿäÿ≠ŸÑŸÖ ŸÉÿßÿ®Ÿàÿ≥", "ŸÖÿ´ŸÑ: ÿ≠ÿØ ÿ®Ÿäÿ∞ÿßŸÉÿ± ŸàŸÖÿ¥ ŸÅÿßŸáŸÖ ÿ≠ÿßÿ¨ÿ©",
                "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿµÿ∑ÿßÿØ ÿ≥ŸÖŸÉ", "ŸÖÿ´ŸÑ: ÿπÿ±Ÿäÿ≥ ŸÅŸä ÿßŸÑŸÉŸàÿ¥ÿ©", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®ŸäÿπÿØŸä ÿßŸÑÿ¥ÿßÿ±ÿπ ŸÅŸä ÿßŸÑÿ≤ÿ≠ŸÖÿ©",
                "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®ŸäÿßŸÉŸÑ ŸÖŸÑŸàÿÆŸäÿ© ÿ≥ÿÆŸÜÿ©", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ±ÿßŸÉÿ® ÿÆŸäŸÑ", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ∫Ÿäÿ± ŸÑŸÖÿ®ÿ©",
                "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ™ÿÆÿßŸÜŸÇ ŸÖÿπ ÿÆŸäÿßŸÑŸá", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ≠ÿßŸàŸÑ ŸäŸÅÿ™ÿ≠ ÿ®ÿ±ÿ∑ŸÖÿßŸÜ ŸÖÿ±ÿ®Ÿâ", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ¨ÿ±Ÿä ŸÅŸä ÿ≥ÿ®ÿßŸÇ",
                "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®ŸäÿµŸàÿ± ÿ≥ŸäŸÑŸÅŸä", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ¥ÿ±ÿ® ÿ¥ÿßŸä ÿ≥ÿÆŸÜ", "ŸÖÿ´ŸÑ: Ÿàÿßÿ≠ÿØ ÿ®Ÿäÿ≠ÿßŸàŸÑ ŸäŸÑÿ®ÿ≥ ÿ®ŸÜÿ∑ŸÑŸàŸÜ ÿ∂ŸäŸÇ"
            ]
        };

        const uiText = {
            en: {
                start: "Tap to Start", mode_title: "Select Game", setup_title: "Rounds",
                modes: { riddles: "Riddles", challenge: "Challenge", drawing: "Drawing", acting: "Acting" },
                btn_next: "Next Card", btn_spin: "Spin Wheel", btn_reveal: "Tap to Reveal",
                settings: "Settings", lang: "Language", dark: "Dark Mode",
                exit_title: "Exit?", exit_msg: "Progress will be lost.", game_over: "Game Over!",
                inst: {
                    riddles: "Read aloud. Reveal answer.",
                    challenge: "Spin and do the task!",
                    drawing: "Draw this item.",
                    acting: "Act without speaking."
                }
            },
            ar: {
                start: "ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿ®ÿØÿ°", mode_title: "ÿßÿÆÿ™ÿßÿ± ÿßŸÑŸÑÿπÿ®ÿ©", setup_title: "ŸÉÿßŸÖ ÿ¨ŸàŸÑÿ©ÿü",
                modes: { riddles: "ŸÅŸàÿßÿ≤Ÿäÿ±", challenge: "ÿ™ÿ≠ÿØŸäÿßÿ™", drawing: "ÿ±ÿ≥ŸÖ", acting: "ÿ™ŸÖÿ´ŸäŸÑ" },
                btn_next: "ÿßŸÑÿ™ÿßŸÑŸä", btn_spin: "ŸÑŸÅ ÿßŸÑÿπÿ¨ŸÑÿ©", btn_reveal: "ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ≠ŸÑ",
                settings: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™", lang: "ÿßŸÑŸÑÿ∫ÿ©", dark: "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä",
                exit_title: "ÿÆÿ±Ÿàÿ¨ÿü", exit_msg: "Ÿáÿ™ÿÆÿ≥ÿ± ÿßŸÑÿØŸàÿ± ÿßŸÑÿ≠ÿßŸÑŸä.", game_over: "ÿÆŸÑÿµÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!",
                inst: {
                    riddles: "ÿßŸÇÿ±ÿ£ ÿßŸÑŸÅÿ≤Ÿàÿ±ÿ©. ÿ¥ŸàŸÅ ÿßŸÑÿ≠ŸÑ.",
                    challenge: "ŸÑŸÅ ÿßŸÑÿπÿ¨ŸÑÿ© ŸàŸÜŸÅÿ∞ ÿßŸÑÿ≠ŸÉŸÖ!",
                    drawing: "ÿßÿ±ÿ≥ŸÖ ÿßŸÑÿ≠ÿßÿ¨ÿ© ÿØŸä.",
                    acting: "ŸÖÿ´ŸÑ ŸÖŸÜ ÿ∫Ÿäÿ± ŸÉŸÑÿßŸÖ."
                }
            }
        };

        // --- STATE ---
        let state = { lang: 'en', mode: '', deck: [], index: 0, count: 20 };

        $(document).ready(function() {
            setCount(20);
        });

        // --- FUNCTIONS ---

        function enterApp() {
            const el = document.documentElement;
            if (el.requestFullscreen) el.requestFullscreen().catch(()=>{});
            else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            showScreen('screen-modes');
        }

        function showScreen(id) {
            $('.screen').removeClass('active');
            $(`#${id}`).addClass('active');
        }

        function prepareSetup(mode) {
            state.mode = mode;
            showScreen('screen-setup');
        }

        function setCount(n) {
            state.count = n;
            $('.count-btn').removeClass('active');
            $(`#btn-c-${n}`).length ? $(`#btn-c-${n}`).addClass('active') : $('.count-btn').filter((i,e)=>$(e).text()==n).addClass('active');
        }

        function startGame() {
            state.index = 0;
            // Shuffle
            let pool = [...db[state.mode]];
            for (let i = pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }
            state.deck = pool.slice(0, state.count);
            
            updateLabels();
            showScreen('screen-game');
            renderCard();
        }

        // --- RENDERER ---
        function renderCard() {
            const container = $('#game-card'); 
            const content = $('#card-content');
            const item = state.deck[state.index];
            const t = uiText[state.lang];
            const btn = $('#btn-next');

            // Reset Anim
            container.removeClass('animate__zoomIn');
            void container[0].offsetWidth; 
            container.addClass('animate__zoomIn');

            $('#counter').text(`${state.index + 1}/${state.deck.length}`);

            let html = '';
            
            // Add instructions inside card
            html += `<div class="text-sub mb-4" style="color:var(--text-sub);">${t.inst[state.mode]}</div>`;

            if (state.mode === 'riddles') {
                html += `
                    <div class="ar-font fw-bold mb-4" style="font-size:1.3rem;">${item.q}</div>
                    <div class="blur-box" onclick="this.classList.add('revealed')">
                        <small class="text-sub d-block mb-1" style="font-size:0.7rem">${t.btn_reveal}</small>
                        <h2 class="blur-text ar-font fw-bold m-0" style="color:var(--text-main)">${item.a}</h2>
                    </div>
                `;
                btn.text(t.btn_next).prop('disabled', false).attr('onclick', 'nextCard()');
            } 
            else if (state.mode === 'challenge') {
                html += `<div class="spin-text ar-font" id="spin-val">???</div>`;
                btn.text(t.btn_spin).prop('disabled', false).attr('onclick', 'spinWheel()');
            } 
            else {
                html += `
                    <div class="display-1 mb-3">${state.mode==='drawing'?'üé®':'üé≠'}</div>
                    <div class="ar-font fw-bold display-6">${item}</div>
                `;
                btn.text(t.btn_next).prop('disabled', false).attr('onclick', 'nextCard()');
            }

            content.html(html);
            updateProgress();
        }

        function spinWheel() {
            const item = state.deck[state.index];
            const display = $('#spin-val');
            const btn = $('#btn-next');
            const t = uiText[state.lang];
            
            let count = 0;
            btn.prop('disabled', true); // Lock

            const interval = setInterval(() => {
                display.text(['‚ö°','üî•','üéØ','üé≤'][count % 4]);
                count++;
                if (count > 20) {
                    clearInterval(interval);
                    display.text(item);
                    display.addClass('animate__animated animate__tada');
                    btn.text(t.btn_next).prop('disabled', false).attr('onclick', 'nextCard()');
                }
            }, 80);
        }

        function nextCard() {
            if (state.index < state.deck.length - 1) {
                state.index++;
                renderCard();
            } else {
                $('#d-title').text("üéâ");
                $('#d-msg').text(uiText[state.lang].game_over);
                $('.btn-no').hide();
                $('.btn-yes').text("OK").attr('onclick', "performExit()");
                $('#custom-dialog').css('display', 'flex').hide().fadeIn();
            }
        }

        function updateProgress() {
            const current = state.index + 1;
            const total = state.deck.length;
            const pct = (current / total) * 100;
            $('#progress-bar').css('width', pct + '%');
        }

        // --- UTILS ---
        function confirmExit() {
            $('#d-title').text(uiText[state.lang].exit_title);
            $('#d-msg').text(uiText[state.lang].exit_msg);
            $('.btn-no').show().text(state.lang === 'en' ? 'No' : 'ŸÑÿ£');
            $('.btn-yes').text(state.lang === 'en' ? 'Yes' : 'ÿ£ŸäŸàÿ©').attr('onclick', "performExit()");
            // Force flex display for centering
            $('#custom-dialog').css('display', 'flex').hide().fadeIn();
        }

        function performExit() {
            $('#custom-dialog').fadeOut();
            showScreen('screen-modes');
        }

        function toggleSettings() {
            const m = $('#settings-modal');
            const o = $('.modal-overlay');
            if (o.css('display') === 'flex') { o.fadeOut(); } else { o.css('display', 'flex').hide().fadeIn(); }
        }

        function toggleMode() {
            const btn = $('#modeSwitch');
            const isDark = btn.hasClass('active'); 
            if(isDark) {
                btn.removeClass('active');
                $('body').attr('data-mode', 'light');
            } else {
                btn.addClass('active');
                $('body').attr('data-mode', 'dark');
            }
        }

        function setLang(l) {
            state.lang = l;
            $('.lang-btn').removeClass('active');
            $(`#btn-lang-${l}`).addClass('active');
            updateLabels();
        }

        function updateLabels() {
            const t = uiText[state.lang];
            $('#txt-title-mode').text(t.mode_title);
            $('#txt-how-many').text(t.setup_title);
            $('#mode-riddles').text(t.modes.riddles);
            $('#mode-challenge').text(t.modes.challenge);
            $('#mode-drawing').text(t.modes.drawing);
            $('#mode-acting').text(t.modes.acting);
            $('#lbl-settings').text(t.settings);
            $('#lbl-dark').text(t.dark);
            $('#lbl-lang').text(t.lang);
        }
    </script>
</body>
</html>