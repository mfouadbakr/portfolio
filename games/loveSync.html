<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LoveSync - Cinematic</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* --- Cinematic Global Styles --- */
        :root {
            --crimson-primary: #dc2626;
            --crimson-dark: #7f1d1d;
            --bg-deep: #050505;
        }

        body {
            background-color: var(--bg-deep);
            color: #f1f5f9;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Film Grain Texture */
        .bg-noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* Fonts */
        .font-cinematic { font-family: 'Playfair Display', serif; }
        .font-arabic { font-family: 'Cairo', sans-serif; }
        .font-ui { font-family: 'Montserrat', sans-serif; }

        /* Animations */
        @keyframes slide-up-fade {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up-fade {
            animation: slide-up-fade 0.8s cubic-bezier(0.2, 1, 0.3, 1) forwards;
        }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .animate-pulse-soft {
            animation: pulse-soft 3s infinite ease-in-out;
        }

        @keyframes float-slow {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float-slow 6s ease-in-out infinite; }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.3; filter: blur(80px); }
            50% { opacity: 0.5; filter: blur(90px); }
        }
        .animate-pulse-glow { animation: pulse-glow 4s ease-in-out infinite; }

        /* UI Elements */
        .glass-panel {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 1);
        }

        .text-glow {
            text-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Input Animation */
        .input-group:focus-within .input-line {
            transform: scaleX(1);
        }
        
        /* Utility for input line animation */
        .group:focus-within .group-focus-within\:scale-x-100 {
            transform: scaleX(1);
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="selection:bg-red-600 selection:text-white">

    <!-- Background Elements -->
    <canvas id="heartCanvas" class="fixed inset-0 pointer-events-none z-0 mix-blend-plus-lighter opacity-60"></canvas>
    <div class="bg-noise z-0"></div>
    <div class="fixed inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,#000000_100%)] z-10 opacity-80"></div>
    
    <!-- Letterbox Bars -->
    <div class="fixed top-0 left-0 right-0 h-0 md:h-10 bg-black z-50 transition-all duration-1000 border-b border-white/5"></div>
    <div class="fixed bottom-0 left-0 right-0 h-0 md:h-10 bg-black z-50 transition-all duration-1000 border-t border-white/5"></div>

    <!-- Main App Container -->
    <div id="app" class="relative w-full h-full min-h-screen overflow-hidden">
        <!-- Content injected by JS -->
    </div>

    <script>
        // --- DATA ---
        const EPISODES = [
          {
            id: 0,
            title: "1. Beginnings & Traits",
            subtitle: "On personalities, habits, and first impressions.",
            icon: "๐",
            color: "from-indigo-900 to-slate-900",
            scenes: [
              {
                name: "ุทุจุนู ููุง ุทุจุนูุ",
                dialogue: [
                  { speaker: "Narrator", text: "ูู ูุงุญุฏ ูููุง ุนูุฏู ุทุจุน ูุนูู ุจูุฑุชุงุญ ูููุ ุฎุตูุตุงู ูู ุฃูู ุงูุฌูุงุฒ." },
                  { speaker: "p1", text: "ุฃูุง ุจุญุณ ุฅูู ุจุญุจ ุงููุฏูุก ูุฃูุนุฏ ูู ุงูุจูุช ุฃูุชุฑ." },
                  { speaker: "p2", text: "ุจุณ ุฃูุง ุจุญุจ ุงูุญุฑูุฉ ูุงููุงุณ ูุงูุฎุฑูุฌ!" },
                ],
                question: "ูู ุฌุงููุง ููู ุฃุฌุงุฒุฉ ููุงุฌุฆุ ุฅูู ุฃูุชุฑ ุญุงุฌุฉ ุชุจุณุทูุง ูุนูููุงุ",
                choices: [
                  "ููุถูู ูู ุงูุจูุชุ ุฃูู ูููู ูุฑููุงู.",
                  "ูุฎุฑุฌ ูุชูุดู ุฃู ูุชุนุดู ูู ููุงู ุฌุฏูุฏ.",
                  "ูุนุฒู ุตุญุงุจูุง ุฃู ูุฑุงูุจูุง ููุนูู ููู.",
                  "ูุฑูุจ ุงูุนุฑุจูุฉ ููุณุงูุฑ ุฃู ุญุชู ูุฑูุจุฉ."
                ],
                outcomes: [
                  { title: "ุนุดุงู ุงููุฏูุก", description: "ุฃูุชู ุงูุงุชููู ุจุชูุฏุฑูุง ุงูุฑุงุญุฉ ูุงูุฎุตูุตูุฉ. ุจูุชููุง ูู ููููุชูู.", matchBonus: 100 },
                  { title: "ูุญุจู ุงูุญูุงุฉ", description: "ุจุชุญุจูุง ุงูุงุณุชูุดุงู ูุงูุชุบููุฑุ ุงูููู ูููุด ููุงู ุจูููู.", matchBonus: 90 },
                  { title: "ุงุฌุชูุงุนููู ุฌุฏุงู", description: "ุงูููุฉ ูุงููุงุณ ููุง ูุตุฏุฑ ุทุงูุชููุ ุจูุชูู ููุจูู ููุชูุญ ุฏุงููุงู.", matchBonus: 85 },
                  { title: "ูุบุงูุฑูู", description: "ุนูุฏูู ุฑูุญ ุงูุทูุงูุ ููุณุชุนุฏูู ูุฃู ุญุงุฌุฉ ูุฌูููุฉ ุณูุง.", matchBonus: 95 }
                ],
                discussionTopic: "ุฅูู ุฃูุชุฑ ุทุจุน ููุง ุจุชุฎุงู ุฅูู ูุถุงููู ุจุนุฏ ุงูุฌูุงุฒุ ูุฅุฒุงู ูุชุนุงูู ูุนุงูุ"
              },
              {
                name: "ููุช ุงูุฒุนู",
                dialogue: [
                  { speaker: "Narrator", text: "ุงูุฎูุงูุงุช ุจุชุญุตู ูู ุฃุญุณู ุงูุจููุชุ ุงูููู ุฅุฒุงู ุจูุชุนุงูู ููุชูุง." },
                  { speaker: "p2", text: "ุฃูุง ููุง ุจุชุนุตุจ ูุด ุจุนุฑู ุงุชููู." },
                  { speaker: "p1", text: "ูุฃูุง ุจููู ุนุงูุฒ ุฃุญู ุงููุดููุฉ ุฏูููุชู ุญุงูุงู!" },
                ],
                question: "ููุง ูุดุฏ ูุน ุจุนุถ ุฌุงูุฏุ ุฅูู ุงูุญู ุงูุฃูุณุจ ูููุงุ",
                choices: [
                  "ูุณูุจ ุจุนุถ ุณุงุนุฉ ููุฏู ูุจุนุฏูู ูุชููู.",
                  "ูุชุนุงุชุจ ูู ุณุงุนุชูุง ููููุงูุด ุฒุนูุงููู.",
                  "ูุงุญุฏ ูููุง ูุชูุงุฒู ุนุดุงู ุงููุฑูุจ ุชูุดู.",
                  "ููุชุจ ูุจุนุถ ุฑุณุงูู ูู ุงูููุงู ุตุนุจ."
                ],
                outcomes: [
                  { title: "ุงูุนููุงุก", description: "ุจุชุฏู ูุจุนุถ ูุณุงุญุฉุ ูุฏู ุฏููู ูุถุฌ ูุจูุฑ.", matchBonus: 95 },
                  { title: "ุงูููุจ ุงูุทูุจ", description: "ูุด ุจุชุทูููุง ุงูุฒุนูุ ูุฏู ุญุงุฌุฉ ุฌูููุฉ ุจุณ ูุญุชุงุฌุฉ ุตุจุฑ.", matchBonus: 90 },
                  { title: "ุงููุถุญูู", description: "ุงูุชูุงุฒู ุฌูููุ ุจุณ ูุงุฒู ูููู ูุชุจุงุฏู ุนุดุงู ูุญุฏุด ูุฌู ุนูู ููุณู.", matchBonus: 80 },
                  { title: "ุงูุฑููุงูุณููู", description: "ุงูุชุนุจูุฑ ุจุงููุชุงุจุฉ ุจูุฎูููู ุชุทูุนูุง ุงููู ุฌูุงูู ุจุตุฏู.", matchBonus: 85 }
                ],
                discussionTopic: "ูู ูู ูุฑุฉ ุฒุนููุง ูู ุจุนุถ ูุญูููุงูุง ุบูุทุ ุฅูู ุงูุทุฑููุฉ ุงููู ุชุฑูุญู ููุง ุชููู ูุถุงููุ"
              }
            ]
          },
          {
            id: 1,
            title: "2. Future Home",
            subtitle: "Daily life, chores, and household responsibilities.",
            icon: "๐",
            color: "from-blue-900 to-slate-900",
            scenes: [
              {
                name: "ุดุบู ุงูุจูุช",
                dialogue: [
                  { speaker: "Narrator", text: "ุงูุจูุช ุนุดุงู ููุถู ูุถูู ููุฑูุญ ูุญุชุงุฌ ูุฌููุฏ ูู ุงูุทุฑููู." },
                  { speaker: "p1", text: "ุฃูุง ุจุนุฑู ุฃุทุจุฎ ุญูู ุฃูู ุนูู ููุฑุฉ." },
                  { speaker: "p2", text: "ูุฃูุง ูุจุญุจุด ุบุณูู ุงูููุงุนูู ุฎุงูุต!" },
                ],
                question: "ูููุณู ุดุบู ุงูุจูุช ุฅุฒุงูุ",
                choices: [
                  "ูู ุญุงุฌุฉ ุจุงููุต ุจุงูุธุจุทุ ุนุฏู.",
                  "ุงููู ูุทุจุฎุ ุงูุชุงูู ูุบุณู ุงูููุงุนูู ูููุถู.",
                  "ูู ูุงุญุฏ ูุนูู ุงููู ุจูุญุจูุ ูุงูุจุงูู ูุชุนุงูู ููู.",
                  "ูุฌูุจ ุญุฏ ูุณุงุนุฏูุง ููุดุชุฑู ุฏูุงุบูุง."
                ],
                outcomes: [
                  { title: "ูุฑูู ูุชุณุงูู", description: "ุงูุนุฏู ุฃุณุงุณ ุนูุงูุชููุ ูููุด ุญุฏ ุดุงูู ุฃูุชุฑ ูู ุงูุชุงูู.", matchBonus: 90 },
                  { title: "ูุฑูู ูุชูุงูู", description: "ุจุชููููุง ุจุนุถุ ูุฏู ุฃุญูู ุญุงุฌุฉ ูู ุงููุดุงุฑูุฉ.", matchBonus: 100 },
                  { title: "ุงููุฑูุญูู", description: "ุจุชุงุฎุฏูุง ุงูุฃููุฑ ุจุจุณุงุทุฉ ููุด ุจุชุนูุฏูุง ุงูุฏููุง.", matchBonus: 85 },
                  { title: "ุงูุนููููู", description: "ุจุชูุฏุฑูุง ููุชูู ูุฑุงุญุชููุ ูุฏู ุชูููุฑ ุนููู.", matchBonus: 80 }
                ],
                discussionTopic: "ุฅูู ุฃูุชุฑ ุดุบูุงูุฉ ูู ุงูุจูุช ุจุชูุฑูุง ููุณุชุญูู ุชุนูููุงุ"
              },
              {
                name: "ุงูููุฒุงููุฉ ูุงููุตุงุฑูู",
                dialogue: [
                  { speaker: "Narrator", text: "ุงููููุณ ุฌุฒุก ููู ูู ุฅุฏุงุฑุฉ ุงูุจูุชุ ููุงุฒู ูุชูู ุนููู ูู ุฏูููุชู." },
                  { speaker: "p1", text: "ูุญูุด ููุง ูุตุฑู ููุชุจุณุทุ" },
                ],
                question: "ูู ูุนุงูุง ูุจูุบ ุฒูุงุฏุฉ ุขุฎุฑ ุงูุดูุฑุ ูุนูู ุจูู ุฅููุ",
                choices: [
                  "ูุดููู ููุฒูู (ุชุญููุด).",
                  "ูุฌูุจ ุญุงุฌุฉ ูุงูุตุฉ ูู ุงูุจูุช (ุชุฌููุฒ).",
                  "ูุฎุฑุฌ ุฎุฑูุฌุฉ ุญููุฉ ุฃู ูุณุงูุฑ (ุฑูุงููุฉ).",
                  "ูุชุตุฏู ุจุฌุฒุก ููุดูู ุงูุจุงูู (ุจุฑูุฉ)."
                ],
                outcomes: [
                  { title: "ุงูุญุฑูุตูู", description: "ุงูุฃูุงู ุงููุงุฏู ููู ูููู ุฌุฏุงู.", matchBonus: 90 },
                  { title: "ุจูุงุฉ ุงูุนุด", description: "ุงูุจูุช ูู ุงุณุชุซูุงุฑูู ุงูุฃูู.", matchBonus: 85 },
                  { title: "ุนุดุงู ุงููุญุธุฉ", description: "ุจุชุญุจูุง ุชุนูุดูุง ุงูููู ุจูููู ูุชุณุชูุชุนูุง.", matchBonus: 80 },
                  { title: "ุฃูู ุงููุฑู", description: "ุงูุจุฑูุฉ ูู ุฃุณุงุณ ุญูุงุชููุ ูุชูููุฑูู ูุชูุงุฒู.", matchBonus: 100 }
                ],
                discussionTopic: "ุฅุฒุงู ููุฏูุฑ ูุฑุชุจุงุชูุงุ ูู ููุนูู ุฐูุฉ ูุงููุฉ ูุดุชุฑูุฉ ููุง ูู ูุงุญุฏ ูุณุชููุ"
              }
            ]
          },
          {
            id: 2,
            title: "3. Family & In-Laws",
            subtitle: "Boundaries, visits, and family relationships.",
            icon: "๐จโ๐ฉโ๐งโ๐ฆ",
            color: "from-emerald-900 to-slate-900",
            scenes: [
              {
                name: "ุฒูุงุฑุฉ ุญูุงุชู",
                dialogue: [
                  { speaker: "Narrator", text: "ุงูุนูุงูุฉ ูุน ุงูุฃูู ุจุชุฃุซุฑ ุฌุฏุงู ุนูู ุงุณุชูุฑุงุฑ ุงูุจูุช." },
                  { speaker: "p2", text: "ุฃูู ุจุชุญุจ ุชุดูููุง ูุชูุฑ." },
                  { speaker: "p1", text: "ูุงุญูุง ููุงู ูุญุชุงุฌูู ููุช ูุจูุชูุง." },
                ],
                question: "ุดุงูููู ุงููุนุฏู ุงูููุงุณุจ ูุฒูุงุฑุฉ ุงูุฃูู ุฅููุ",
                choices: [
                  "ููู ุงูุฌูุนุฉ ุฏู ููุฏุณ ููุนููุฉ ูููุง.",
                  "ูุฑุฉ ูู ูุต ุงูุฃุณุจูุน ููุฑุฉ ูู ุงูุฃุฌุงุฒุฉ.",
                  "ุญุณุจ ุงูุธุฑูู ูุงููุถูุ ูู ุบูุฑ ููุงุนูุฏ ุซุงุจุชุฉ.",
                  "ูุงุฒู ูุฎุตุต ููู ูููุง ููุญุฏูุงุ ูููู ููุฃูู."
                ],
                outcomes: [
                  { title: "ุงููุงุตููู", description: "ุตูุฉ ุงูุฑุญู ุนูุฏูู ุฃุณุงุณูุฉุ ุฑุจูุง ูุจุงุฑู ููู.", matchBonus: 90 },
                  { title: "ุงูุงุฌุชูุงุนููู", description: "ุจุชุญุจูุง ุงููุฏ ููุด ุนุงูุฒูู ุญุฏ ูุฒุนู.", matchBonus: 85 },
                  { title: "ุงูููุฏุฑู", description: "ูุด ุจุชุญุจูุง ุงูุฑูุชููุ ูุฏู ุจูุฎูู ุงูุฒูุงุฑุงุช ุฃุฎู.", matchBonus: 80 },
                  { title: "ุงููุชูุงุฒููู", description: "ุจุชุญุงูุธูุง ุนูู ุฎุตูุตูุชูู ูุจุฑุถู ุจุชุฑุถูุง ุฃูููู.", matchBonus: 100 }
                ],
                discussionTopic: "ูู ุญุตู ุชุฏุฎู ูู ุงูุฃูู ูู ูุดููุฉ ุจููุงุ ููุชุตุฑู ุฅุฒุงูุ"
              },
              {
                name: "ุฃุณุฑุงุฑ ุงูุจูุช",
                dialogue: [
                  { speaker: "Narrator", text: "ุงููู ุจูุญุตู ูู ุงูุจูุช ุงูููุฑูุถ ููุถู ูู ุงูุจูุช." },
                ],
                question: "ูู ุญุตูุช ูุดููุฉ ูุจูุฑุฉ ุจููุงุ ููู ุฃูู ูุงุญุฏ ูููู ุชุญููููุ",
                choices: [
                  "ุฃูู / ุฃุจููุง ุทุจุนุงู.",
                  "ุฃูุฑุจ ุตุงุญุจ ููุง.",
                  "ูุญุฏุด ุฎุงูุตุ ุฏู ุฃุณุฑุงุฑูุง.",
                  "ุญุฏ ุญููู ูู ุงูุนููุฉ ูุซู ููู."
                ],
                outcomes: [
                  { title: "ุงุจู ุฃูู/ุฃุจูู", description: "ุงูุซูุฉ ูู ุงูุฃูู ูุจูุฑุฉุ ุจุณ ุฎุฏูุง ุจุงููู ูู ุงูุฎุตูุตูุฉ.", matchBonus: 70 },
                  { title: "ุงูุฃุตุฏูุงุก", description: "ุงูุตุญุงุจ ุณูุฏุ ุจุณ ูุด ูู ูู ุญุงุฌุฉ.", matchBonus: 75 },
                  { title: "ุงููุชูููู", description: "ูุฏู ุงูุตุญ! ูุดุงูููู ุญููุง ุจูููู ุฃูุชู ุงูุงุชููู.", matchBonus: 100 },
                  { title: "ุงูุนููุงุก", description: "ุงููุฌูุก ูุญูู ููุช ุงูุฃุฒูุงุช ุงููุจูุฑุฉ ุชุตุฑู ุดุฑุนู ูุณููู.", matchBonus: 90 }
                ],
                discussionTopic: "ูุชูู ุฏูููุชู: ุฅูู ุงูุฎุท ุงูุฃุญูุฑ ุงููู ููููุน ูุทูุน ุจุฑู ุจุงุจ ุดูุชูุงุ"
              }
            ]
          },
          {
            id: 3,
            title: "4. Faith & Spirituality",
            subtitle: "Relationship with God and household worship.",
            icon: "๐",
            color: "from-amber-900 to-slate-900",
            scenes: [
              {
                name: "ุงูุตูุงุฉ ูุงููุฑุขู",
                dialogue: [
                  { speaker: "Narrator", text: "ุงูุจูุช ุงููู ููู ุทุงุนุฉ ููู ุจุฑูุฉ ูุณูููุฉ." },
                  { speaker: "p1", text: "ููุณู ูุดุฌุน ุจุนุถ ุนูู ุงูุตูุงุฉ." },
                ],
                question: "ุฅูู ุฃูุชุฑ ุญุงุฌุฉ ุชุญุจ ูุนูููุง ุณูุง ุนุดุงู ููุฑุจ ูู ุฑุจูุงุ",
                choices: [
                  "ูุตูู ุฑูุนุชูู ููุงู ุณูุง ูู ูููุฉ.",
                  "ูุญูุธ ูุฑุขู ูุน ุจุนุถ ููุณูุน ูุจุนุถ.",
                  "ูุนูู ูุฑุฏ ุงุณุชุบูุงุฑ ูููู ุณูุง.",
                  "ูุณูุน ุฏุฑุณ ุฏููู ููุชูุงูุด ููู."
                ],
                outcomes: [
                  { title: "ุงูููุงููู", description: "ููุฑ ุงูุตูุงุฉ ููููู ุจูุชูู ุณูููุฉ.", matchBonus: 100 },
                  { title: "ุฃูู ุงููุฑุขู", description: "ุฎูุฑูู ูู ุชุนูู ุงููุฑุขู ูุนูููุ ุฃุฌูู ูุฏู.", matchBonus: 100 },
                  { title: "ุงูุฐุงูุฑูู", description: "ุฐูุฑ ุงููู ุจูุญูุธ ุงูุจูุช ูุงููููุจ.", matchBonus: 95 },
                  { title: "ุงููุชุฏุจุฑูู", description: "ุงูููู ูุงูุนูู ููููู ุฅููุงููู ุฌุฏุงู.", matchBonus: 90 }
                ],
                discussionTopic: "ุฅุฒุงู ูุตุญู ุจุนุถ ูุตูุงุฉ ุงููุฌุฑ ูู ุบูุฑ ูุง ููุณู ุฃู ูุชุถุงููุ"
              },
              {
                name: "ุฑูุถุงู ูุงูุนูุฏ",
                dialogue: [
                  { speaker: "Narrator", text: "ุงูููุงุณู ุงูุฏูููุฉ ูููุง ุทุนู ุชุงูู ูุงูุชูุง ูุน ุจุนุถ." },
                ],
                question: "ุฑูุถุงู ูู ุจูุชูุง ููููู ุดููู ุฅููุ",
                choices: [
                  "ุนุฒููุงุช ูููุฉ ุนููุฉ ูู ููู.",
                  "ุนุจุงุฏุฉ ูุงุนุชูุงู ููุฏูุก.",
                  "ูููุณ ุจูู ุงูุนุจุงุฏุฉ ูุงูุฎุฑูุฌุงุช ูุงูุณุญูุฑ.",
                  "ูุนูู ุฎูุฑ ูููุฒุน ูุฌุจุงุช ุณูุง."
                ],
                outcomes: [
                  { title: "ุฃูู ุงููุฑู", description: "ุจูุชูู ููุชูุญ ูุนุงูุฑ ุจุงูุฎูุฑ.", matchBonus: 90 },
                  { title: "ุงููุชุจุชููู", description: "ุจุชุฑูุฒูุง ูู ุงูุฑูุญุงููุงุช ูุฏู ุจูุดุญููู ูุจุงูู ุงูุณูุฉ.", matchBonus: 95 },
                  { title: "ุงููุณุทููู", description: "ุจุชุนุฑููุง ุชุณุชูุชุนูุง ุจูู ุฌูุงูุจ ุงูุดูุฑ ุงููุฑูู.", matchBonus: 100 },
                  { title: "ุงูุฎูุฑูู", description: "ูุณุงุนุฏุชูู ูููุงุณ ูุชููู ุณุจุจ ุณุนุงุฏุชูู.", matchBonus: 100 }
                ],
                discussionTopic: "ูุงูููู ูุนูู ุฅูู ุตุฏูุฉ ุฌุงุฑูุฉ ุจุงุณููุง ุฅุญูุง ุงูุงุชูููุ"
              }
            ]
          },
          {
            id: 4,
            title: "5. Raising Children",
            subtitle: "Future family, names, and parenting styles.",
            icon: "๐ถ",
            color: "from-pink-900 to-slate-900",
            scenes: [
              {
                name: "ุงูุฃุณูุงุก ูุงูุนุฏุฏ",
                dialogue: [
                  { speaker: "Narrator", text: "ููุง ุฑุจูุง ููุฑููุง ุจุฃุทูุงูุ ููุฎุชูู ููุง ููุชููุ" },
                  { speaker: "p2", text: "ุฃูุง ุจุญุจ ุงูุฃุณุงูู ุงููุฏููุฉ." },
                  { speaker: "p1", text: "ุฃูุง ุจุญุจ ุงูุฃุณุงูู ุงูุฌุฏูุฏุฉ ูุงููุทุฑูุนุฉ." },
                ],
                question: "ุชุญุจูุง ุชุฎูููุง ูุงู ุทูู ูุจุฏุฆูุงูุ",
                choices: [
                  "ุทูู ูุงุญุฏ ููุงูุฉ ุนุดุงู ูุฑูุฒ ูุนุงู.",
                  "ุงุชููู (ุจูุช ูููุฏ) ุญูู ุฃูู.",
                  "ุชูุงุชุฉ ุฃู ุฃูุชุฑุ ุงูุนุฒูุฉ ุญููุฉ.",
                  "ูุณูุจูุง ุนูู ุงููู ููุฎุทุทุด ุฏูููุชู."
                ],
                outcomes: [
                  { title: "ุงููุฑูุฒูู", description: "ุนุงูุฒูู ุชุทูุนูุง ุฌูุฏุฉ ุชุฑุจูุฉ ุนุงููุฉ.", matchBonus: 85 },
                  { title: "ุงูุชูููุฏููู", description: "ุงูุฃุณุฑุฉ ุงููููุฐุฌูุฉ ูู ุฎูุงููู.", matchBonus: 95 },
                  { title: "ุนุดุงู ุงูุนุฒูุฉ", description: "ุจุชุญุจูุง ุงูุฏูุดุฉ ูุงูุญูุงุฉ ูุงูุจูุช ุงููููุงู.", matchBonus: 90 },
                  { title: "ุงููุชููููู", description: "ุงูุฑุถุง ุจูุถุงุก ุงููู ุฃุฌูู ุญุงุฌุฉ.", matchBonus: 100 }
                ],
                discussionTopic: "ูู ุจูุชูุง ุฃู ุงุจููุง ุบูุท ุบูุทุฉ ูุจูุฑุฉุ ููู ูููุง ุงููู ููุนุงูุจ ูููู ุงููู ููุตุงูุญุ (ุงูุดุฑุทู ุงูุทูุจ ูุงูุดุฑูุฑ)"
              },
              {
                name: "ุฃุณููุจ ุงูุชุฑุจูุฉ",
                dialogue: [
                  { speaker: "Narrator", text: "ุงูุฒูู ุตุนุจ ูุงูุชุฑุจูุฉ ูุญุชุงุฌุฉ ุญููุฉ." },
                ],
                question: "ุฅูู ุฃูู ูููุฉ ูุงุฒู ูุฒุฑุนูุง ูู ุฃููุงุฏูุงุ",
                choices: [
                  "ุงูุชุฏูู ูุงูุฃุฎูุงู.",
                  "ุงูุชููู ูุงููุฌุงุญ ุงูุฏุฑุงุณู.",
                  "ููุฉ ุงูุดุฎุตูุฉ ูุงูุงุนุชูุงุฏ ุนูู ุงูููุณ.",
                  "ุงูุญููุฉ ูุตูุฉ ุงูุฑุญู."
                ],
                outcomes: [
                  { title: "ุงููุฑุจูู", description: "ุงูุฏูู ูู ุงูุฃุณุงุณ ุงููู ููุญูููู.", matchBonus: 100 },
                  { title: "ุงูุทููุญูู", description: "ุนุงูุฒูููู ูุงุฏุฉ ููุงุฌุญูู ูู ุฏููุงูู.", matchBonus: 85 },
                  { title: "ุงูุฃูููุงุก", description: "ุนุงูุฒูููู ููุงุฌููุง ุงูุญูุงุฉ ุจููุจ ุฌุงูุฏ.", matchBonus: 95 },
                  { title: "ุงูุญููููู", description: "ุงูููุจ ุงูุฃุจูุถ ููุฒ ูู ุงูุฒูู ุฏู.", matchBonus: 90 }
        ],
        discussionTopic: "ูู ุชูุงูููุง ุนูู ุถุฑุจ ุงูุฃุทูุงู ููุณููุฉ ุนูุงุจุ ููููุ"
      }
    ]
  },
  {
    id: 5,
    title: "6. Love Languages",
    subtitle: "Expressing feelings and affection.",
    icon: "โค๏ธ",
    color: "from-red-900 to-slate-900",
    scenes: [
      {
        name: "ุงูุชุนุจูุฑ ุนู ุงูุญุจ",
        dialogue: [
          { speaker: "Narrator", text: "ูู ูุงุญุฏ ูููุง ุจูุณุชูุจู ุงูุญุจ ุจุทุฑููุฉ ูุฎุชููุฉ." },
          { speaker: "p1", text: "ุฃูุง ุจุญุจ ุงูููุงู ุงูุญูู." },
          { speaker: "p2", text: "ุฃูุง ุจุญุจ ุงูุฃูุนุงู ุฃูุชุฑ." },
        ],
        question: "ุฅูู ุฃูุชุฑ ุญุงุฌุฉ ุชุญุณุณู ุฅู ุงูุทุฑู ุงูุชุงูู ุจูุญุจู ุจุฌุฏุ",
        choices: [
          "ููุง ููููู ููุงู ุญูู ูููุฏุญูู.",
          "ููุง ูุฌูุจูู ูุฏูุฉ ููุงุฌุฃุฉ.",
          "ููุง ูุณุงุนุฏูู ูู ุญุงุฌุฉ ุชูููุฉ ุนููุง.",
          "ููุง ููุถู ููุช ุฎุงุต ูุนุงูุง ูู ุบูุฑ ููุจุงูู."
        ],
        outcomes: [
          { title: "ุฃูู ุงูููุงู", description: "ุงููููุฉ ุงูุทูุจุฉ ุตุฏูุฉุ ูุจุชูุฑู ูุนุงูู ุฌุฏุงู.", matchBonus: 90 },
          { title: "ุฃูู ุงููุฏุงูุง", description: "ุงูุชูุฏูุฑ ุงููุงุฏู ูุนูุงู ุฅูู ูุงูุฑู/ุงูุง.", matchBonus: 85 },
          { title: "ุฃูู ุงูุฃูุนุงู", description: "ุงูููุงูู ูู ุงููู ุจุชุซุจุช ุงูุญุจ ุนูุฏูู.", matchBonus: 100 },
          { title: "ุฃูู ุงูููุช", description: "ูุฌูุฏูู ุณูุง ูู ุฃุบูู ูุง ุชููููู.", matchBonus: 95 }
        ],
        discussionTopic: "ุฅูู ุฃูุชุฑ ุชุตุฑู ุฃูุง ุจุนููู ุจูุญุณุณู ุฅูู ููุชู ุจููุ"
      },
      {
        name: "ุงูุฑููุงูุณูุฉ ุงููุงูุนูุฉ",
        dialogue: [
          { speaker: "Narrator", text: "ุจุนุฏ ุงูุฌูุงุฒ ุงูุฑููุงูุณูุฉ ุดูููุง ุจูุชุบูุฑ." },
        ],
        question: "ุงูุฑููุงูุณูุฉ ุจุงููุณุจุงูู ุจุนุฏ 10 ุณููู ุฌูุงุฒ ูุชุจูู ุฅููุ",
        choices: [
          "ุฎุฑูุฌุฉ ุนุดุงุก ุดูู ูู ุฐูุฑู ุฌูุงุฒูุง.",
          "ููุจุงูุฉ ุดุงู ุณูุง ูู ุงูุจููููุฉ ุจุนุฏ ูุง ุงูุนูุงู ุชูุงู.",
          "ุณูุฑูุฉ ููุญุฏูุง ูุฌุฏุฏ ูููุง ุดูุฑ ุงูุนุณู.",
          "ุฑุณุงูุฉ ุญุจ ุนูู ุงูุชูุงุฌุฉ ุงูุตุจุญ."
        ],
        outcomes: [
          { title: "ุงูููุงุณููููู", description: "ุจุชุญุจูุง ุชุญุงูุธูุง ุนูู ุงูุทููุณ ูุงูููุงุณุจุงุช.", matchBonus: 85 },
          { title: "ุงูุจุณุทุงุก", description: "ุงูุณุนุงุฏุฉ ูู ุงูุชูุงุตูู ุงูุตุบูุฑุฉ ูุงููุฏูุก.", matchBonus: 100 },
          { title: "ุงููุชุฌุฏุฏูู", description: "ุงูุชุบููุฑ ููู ุนุดุงู ุงูุญุจ ููุถู ูููุน.", matchBonus: 95 },
          { title: "ุงููุทูุงุก", description: "ุงูููุงุฌุขุช ุงูุตุบูุฑุฉ ุจุชุฎูู ุงูููู ุฃุญูู.", matchBonus: 90 }
        ],
        discussionTopic: "ุชูุนุฏูู ุจุฅูู ุนุดุงู ููุจูุงุด ุฒูุฌูู ุชูููุฏููู ููููููุ"
      }
    ]
  },
  {
    id: 6,
    title: "7. Ambition & Career",
    subtitle: "Work, growth, and balancing life.",
    icon: "๐ผ",
    color: "from-slate-800 to-black",
    scenes: [
      {
        name: "ุงูุณูุฑ ููุฎุงุฑุฌ",
        dialogue: [
          { speaker: "Narrator", text: "ูู ุฌุงุช ูุฑุตุฉ ุดุบู ููุงุญุฏ ูููู ุจุฑู ูุตุฑ ุจูุจูุบ ูุจูุฑ." },
        ],
        question: "ุฑุฏ ูุนูู ููููู ุฅููุ",
        choices: [
          "ูุณุงูุฑ ููุฑุงูุ ุฏู ูุฑุตุฉ ุงูุนูุฑ.",
          "ุฃูุง ุฃุณุงูุฑ ุงูุฃูู ุฃููู ููุณู ูุจุนุฏูู ุฃุจุนุชููู.",
          "ูุฑูุถุ ุงูุบุฑุจุฉ ุตุนุจุฉ ูุงูููุฉ ุจุงูุฏููุง.",
          "ูุตูู ุงุณุชุฎุงุฑุฉ ููุดูู ุงูุฃูู ุฑุฃููู ุฅูู."
        ],
        outcomes: [
          { title: "ุงูุทููุญูู", description: "ุงููุณุชูุจู ุงููุงุฏู ุฃููููุฉ ูููู.", matchBonus: 90 },
          { title: "ุงููุถุญูู", description: "ูุงุญุฏ ุจูุดูู ุนุดุงู ุงูุชุงูู ูุฑุชุงุญุ ุจุณ ุงูุจุนุฏ ุตุนุจ.", matchBonus: 80 },
          { title: "ุงููููุนูู", description: "ุงูุงุณุชูุฑุงุฑ ุงูููุณู ุฃูู ูู ุงููููุณ ุนูุฏูู.", matchBonus: 95 },
          { title: "ุงููุชุฒููู", description: "ุงูุชููู ูุงููุดูุฑู ููุง ุทุฑูููู ูููุฑุงุฑ ุงูุตุญ.", matchBonus: 100 }
        ],
        discussionTopic: "ูู ุดุบูู ุฃุซุฑ ุนูู ููุชู ูู ุงูุจูุชุ ูุชุณุชุญูููู ููุง ูุชุทูุจ ููู ุฃุบูุฑูุ"
      },
      {
        name: "ุชุทููุฑ ุงูุฐุงุช",
        dialogue: [
          { speaker: "Narrator", text: "ุงููุงุญุฏ ููููุนุด ููู ููุงููุ ูุงุฒู ูุชุทูุฑ." },
        ],
        question: "ูู ุดุฑููู ูุฑุฑ ูููู ุฏุฑุงุณุฉ ูุฏู ููุงุฎุฏ ูู ููุช ุงูุจูุช ูุงููููุณุ",
        choices: [
          "ุฃุดุฌุนู ุฌุฏุงู ูุฃุดูู ุนูู ูุณุคูููุงุช.",
          "ุฃูุงูู ุจุณ ุจุดุฑุท ููุฃุซุฑุด ุนูู ุฃุณุงุณูุงุช ุงูุจูุช.",
          "ุฃุฑูุถุ ุงูุจูุช ูุงูุฃููุงุฏ ุฃููู ุจุงูููุช ูุงููููุณ.",
          "ุฃุดุงุฑูู ูุฃุฏุฑุณ ุฃูุง ููุงู ุญุงุฌุฉ."
        ],
        outcomes: [
          { title: "ุงูุฏุงุนููู", description: "ูุฌุงุญ ุดุฑููู ูู ูุฌุงุญูุ ุนูุงูุฉ ุตุญูุฉ ุฌุฏุงู.", matchBonus: 100 },
          { title: "ุงููุงูุนููู", description: "ุงูุญู ุญูุ ุงูุชูุงุฒู ูุทููุจ.", matchBonus: 90 },
          { title: "ุงูุชูููุฏููู", description: "ุงูุฃุณุฑุฉ ุฃููุงูุ ูุฏู ุฑุฃู ูุญุชุฑู.", matchBonus: 80 },
          { title: "ุงููุชูุงูุณูู", description: "ุจุชุนููุง ุจุจุนุถ ูุจุชุดุฌุนูุง ุจุนุถุ ุซูุงุฆู ูุงุฌุญ.", matchBonus: 95 }
        ],
        discussionTopic: "ุฅูู ุงูุญูู ุงููู ููุณู ุชุญููู ูุฃูุง ุฃูุฏุฑ ุฃุณุงุนุฏู ูููุ"
      }
    ]
  },
  {
    id: 7,
    title: "8. Jealousy & Boundaries",
    subtitle: "Trust, social media, and limits.",
    icon: "๐",
    color: "from-zinc-900 to-black",
    scenes: [
      {
        name: "ุงูุบูุฑุฉ",
        dialogue: [
          { speaker: "Narrator", text: "ุงูุบูุฑุฉ ููุญ ุงูุญุจุ ุจุณ ูู ุฒุงุฏุช ุจุชููุจ ููุฏ." },
          { speaker: "p1", text: "ุฃูุง ุจุบูุฑ ุนููู/ู ุฌุฏุงู." },
        ],
        question: "ูู ุญุฏ ุนูู ุชุนููู ุณุฎูู ุฃู ุนุงูุณ ูุงุญูุง ูุงุดูููุ ุงูุชุตุฑู ุงูุตุญ ุฅููุ",
        choices: [
          "ูุชุฌุงูู ุชูุงูุงู ููููู ุทุฑูููุง.",
          "ูุฑุฏ ุนููู ูููููู ุนูุฏ ุญุฏู.",
          "ููุดู ุจุณุฑุนุฉ ูู ุงูููุงู ุนุดุงู ุงููุดุงูู.",
          "ูุจุต ูุจุนุถ ููุถุญู ูุฎูุงุต."
        ],
        outcomes: [
          { title: "ุงูุนููุงุก", description: "ุงูุชุฌุงูู ุตุฏูุฉ ุนูู ุงูุญูููุ ูุจุชุญููุง ููุณูู.", matchBonus: 100 },
          { title: "ุงูุญูุดููู", description: "ุงููุฑุงูุฉ ุฎุท ุฃุญูุฑุ ุจุณ ุฎููุง ุจุงููู ูู ุงูุนูุงูุจ.", matchBonus: 85 },
          { title: "ุงููุณุงูููู", description: "ุงูุณูุงูุฉ ุบูููุฉุ ุจุชุจุนุฏูุง ุนู ุงูุดุฑ.", matchBonus: 90 },
          { title: "ุงููุงุซููู", description: "ูุงุซููู ูู ุจุนุถ ูููุงู ุงููุงุณ ูููุฒููุด.", matchBonus: 95 }
        ],
        discussionTopic: "ุฅูู ุงูุชุตุฑู ุงููู ูููู ุฃุนููู ุจุนูููุฉ ุจุณ ุจูุซูุฑ ุบูุฑุชู ุฌุฏุงูุ"
      },
      {
        name: "ุงูุณูุดูุงู ููุฏูุง",
        dialogue: [
          { speaker: "Narrator", text: "ุงูููุณ ุจูู ูุงูุงูุณุชุฌุฑุงู ุจููุง ุฌุฒุก ูู ุญูุงุชูุง." },
        ],
        question: "ุฅูู ุณูุงุณุชูุง ูู ุงูู Add ูุงูู Like ููุฌูุณ ุงูุขุฎุฑุ",
        choices: [
          "ุนุงุฏูุ ุฏู ูุฌุฑุฏ ูุฌุงููุงุช ุงุฌุชูุงุนูุฉ.",
          "ููุฒููุงุก ูุงููุฑุงูุจ ุจุณุ ูุจุญุฏูุฏ.",
          "ููููุน ุชูุงูุงูุ ุงูุจุงุจ ุงููู ูุฌููู ููู ุงูุฑูุญ.",
          "ูุนุฑู ุจุงุณููุฑุฏุงุช ุจุนุถ ููู ุญุงุฌุฉ ุนูู ุงูููุดูู."
        ],
        outcomes: [
          { title: "ุงููููุชุญูู", description: "ุดุงูููู ุฅู ุงูุซูุฉ ุฃูุจุฑ ูู ูุงูู ูููููุช.", matchBonus: 80 },
          { title: "ุงููุญุชุฑููู", description: "ุจุชุญุทูุง ุญุฏูุฏ ุดุฑุนูุฉ ูุงุฌุชูุงุนูุฉ ุณูููุฉ.", matchBonus: 95 },
          { title: "ุงูุญุงุณููู", description: "ุจุชูุทุนูุง ุงูุดู ุจุงูููููุ ุฑุงุญุฉ ุจุงู.", matchBonus: 90 },
          { title: "ูุชุงุจ ููุชูุญ", description: "ุงูุดูุงููุฉ ุญููุฉุ ุจุณ ุงูุซูุฉ ุฃูู ูู ุงููุฑุงูุจุฉ.", matchBonus: 85 }
        ],
        discussionTopic: "ูู ุชูุจู ุฅูู ุฃูุณู ููุจุงููู ูุฃููุจ ููู ุจุฑุงุญุชูุ"
      }
    ]
  },
  {
    id: 8,
    title: "9. Free Time",
    subtitle: "Hobbies, vacations, and personal space.",
    icon: "๐จ",
    color: "from-amber-900 to-black",
    scenes: [
      {
        name: "ุงูููุงูุงุช ุงูุดุฎุตูุฉ",
        dialogue: [
          { speaker: "Narrator", text: "ุงูุฌูุงุฒ ูุด ูุนูุงู ุฅููุง ููุฒู ูู ุจุนุถ 24 ุณุงุนุฉ." },
        ],
        question: "ูู ุฃูุง ุนุงูุฒ ุฃูุนุจ ุจูุงูุณุชูุดู / ุฃูุฒู ุดูุจูุฌ ูุงูุชู/ุงูุช ูุด ุนุงูุฒุ ูุชุนูู ุฅููุ",
        choices: [
          "ูุดุงุฑูู ุญุชู ูู ูุด ุนุงุฌุจูู ุนุดุงู ูุจูู ุณูุง.",
          "ูุณูุจู ุจุฑุงุญุชู ูุฃุดูู ุฃูุง ุญุงุฌุฉ ุชุงููุฉ ุฃุนูููุง.",
          "ูุชุถุงูู ูุฃุญุณ ุฅูู ุจุชููููู.",
          "ูุชูู ุนูู ููุช ูุญุฏุฏ ููู ูุงุญุฏ ูุน ููุณู."
        ],
        outcomes: [
          { title: "ุงููุฌุงูููู", description: "ุจุชูุฌูุง ุนูู ููุณูู ุนุดุงู ุงูุชุงููุ ุญุจ ุฌููู.", matchBonus: 90 },
          { title: "ุงููุณุชูููู", description: "ูู ูุงุญุฏ ููู ุดุฎุตูุชูุ ูุฏู ุตุญู ุฌุฏุงู.", matchBonus: 100 },
          { title: "ุงููุชุทูุจูู", description: "ูุญุชุงุฌูู ุฃูุงู ูุงูุชูุงู ุฃูุชุฑ.", matchBonus: 75 },
          { title: "ุงูููุธููู", description: "ุงูุงุชูุงู ูุฑูุญุ ุญูู ูุญูู.", matchBonus: 95 }
        ],
        discussionTopic: "ุฅูู ุงูููุงูุฉ ุงููู ููุณู ูุชุนูููุง ูููุงุฑุณูุง ุณูุงุ"
      }
    ]
  },
  {
    id: 9,
    title: "10. The Vow",
    subtitle: "Promises for a lifetime.",
    icon: "๐",
    color: "from-rose-900 to-black",
    scenes: [
      {
        name: "ูุนุฏ ุงูุนูุฑ",
        dialogue: [
          { speaker: "Narrator", text: "ุงุญูุง ุจูุจูู ุจูุช ุนุดุงู ูุนูุด ุงูุนูุฑ ููู ุฅู ุดุงุก ุงููู." },
          { speaker: "p1", text: "ุฃูุง ุนุงูุฒ ูุนุฏ ููู." },
        ],
        question: "ุฅูู ุฃูู ูุนุฏ ุชุฏููููู ุฏูููุชู ูุงุญูุง ุจูุจุฏุฃ ุงูุทุฑููุ",
        choices: [
          "ุฃูุนุฏู ุฅูู ูุชูู ุฑุจูุง ูููู/ููู ุฏุงููุงู.",
          "ุฃูุนุฏู ุฅููุง ุนูุฑูุง ูุง ูููุงู ุฒุนูุงููู ูู ุจุนุถ.",
          "ุฃูุนุฏู ุฅูู ููุถู ุณูุฏ ูุถูุฑ ูููู/ููู.",
          "ุฃูุนุฏู ุฅู ุญุจู ูููู/ููู ููุฒูุฏ ูู ููู."
        ],
        outcomes: [
          { title: "ุฃูู ุงูุชููู", description: "ูู ูุชู ุงููู ูุฌุนู ูู ูุฎุฑุฌุงูุ ุฏู ุฃููู ูุนุฏ.", matchBonus: 100 },
          { title: "ุฃูู ุงูุณูุงู", description: "ุฑุงุญุฉ ุงูุจุงู ูุงูููุจ ุงูุตุงูู ูุนูุฉ.", matchBonus: 95 },
          { title: "ุฃูู ุงูุณูุฏ", description: "ุงูุฑุฌููุฉ ูุงูุฌุฏุนูุฉ ููุง ุนููุฏ ุงูุจูุช.", matchBonus: 100 },
          { title: "ุฃูู ุงูุญุจ", description: "ุงููุดุงุนุฑ ูููุฏ ุงูุฑุญูุฉุ ุญุงูุธูุง ุนูููุง.", matchBonus: 95 }
        ],
        discussionTopic: "ุฏุนูุฉ ุญููุฉ ุชุฏุนููุง ูุจูุชูุง ูููุณุชูุจููุง ุฏูููุชู ุจุตูุช ุนุงูู."
      }
    ]
  }
];

        // --- GAME STATE ---
        const state = {
            screen: 'SPLASH',
            p1Name: '',
            p2Name: '',
            currentEpisodeId: 0,
            currentSceneIndex: 0,
            dialogueIndex: 0,
            p1Choice: null,
            p2Choice: null,
            turn: 1,
            scores: []
        };

        const INITIAL_STATE = JSON.parse(JSON.stringify(state));

        // --- ACTIONS ---
        function clickSound() {
            // Placeholder for sound
        }

        function setScreen(newScreen) {
            state.screen = newScreen;
            render();
        }

        function updateState(updates) {
            Object.assign(state, updates);
            render();
        }

        function getEpisode() {
            return EPISODES[state.currentEpisodeId];
        }

        function getScene() {
            return getEpisode().scenes[state.currentSceneIndex];
        }

        // --- RENDERERS ---

        function renderSplash() {
            return `
                <div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-6 text-center animate-slide-up-fade">
                  <div class="mb-14 relative group cursor-pointer" onclick="clickSound()">
                    <div class="absolute inset-0 bg-[#dc2626] blur-[80px] opacity-20 group-hover:opacity-30 transition-opacity duration-1000 rounded-full"></div>
                    <i data-lucide="heart" class="text-[#dc2626] w-32 h-32 animate-float fill-[#dc2626]/10 relative z-10 drop-shadow-[0_0_30px_rgba(220,38,38,0.6)]"></i>
                  </div>
                  
                  <div class="mb-16">
                    <h2 class="font-ui text-[#ef4444] tracking-[0.4em] uppercase text-[10px] font-bold mb-6 opacity-80">The Couple's Game</h2>
                    <h1 class="font-cinematic font-bold text-white drop-shadow-2xl text-5xl md:text-6xl text-center leading-tight">LoveSync</h1>
                    <div class="w-16 h-1 bg-[#b91c1c] mx-auto mt-8 rounded-full shadow-[0_0_10px_#ef4444]"></div>
                  </div>
                  
                  <p class="font-cinematic text-zinc-400 mb-16 text-xl max-w-sm mx-auto leading-relaxed italic border-l-2 border-[#b91c1c] pl-4 text-left">
                    "Explore the depths of your connection. Meaningful questions. Real conversations."
                  </p>

                  <div class="w-full max-w-xs z-20">
                    <button onclick="clickSound(); setScreen('SETUP');" class="bg-[#b91c1c] text-white hover:bg-[#991b1b] border-b-4 border-[#7f1d1d] hover:border-[#601515] relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 shadow-xl w-full">
                      Begin Journey
                    </button>
                  </div>
                  
                  <div class="absolute bottom-8 text-center w-full opacity-40 hover:opacity-100 transition-opacity">
                    <span class="font-ui text-[10px] tracking-widest text-zinc-500 uppercase">Developed by Mohamed Bakr</span>
                  </div>
                </div>
            `;
        }

        function renderSetup() {
            // Need to handle input state without re-rendering on every keystroke
            return `
                <div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-6 animate-slide-up-fade max-w-md mx-auto w-full">
                  <div class="glass-panel rounded-lg p-8 md:p-10 relative overflow-hidden w-full bg-black/80 border-t-4 border-t-[#b91c1c]">
                    <div class="text-center mb-10">
                       <h2 class="font-ui text-zinc-500 uppercase tracking-[0.2em] text-xs font-bold">Cast of Characters</h2>
                       <h1 class="font-cinematic font-bold text-white drop-shadow-2xl text-2xl md:text-3xl text-center leading-tight mt-2">The Protagonists</h1>
                    </div>

                    <div class="space-y-8">
                      <div>
                        <label class="block text-center font-cinematic text-lg text-zinc-400 mb-3 italic">Partner One</label>
                        <div class="relative group w-full">
                            <input 
                              type="text" 
                              value="${state.p1Name}" 
                              oninput="state.p1Name = this.value; checkSetupValidity()"
                              placeholder="Enter name..."
                              class="w-full bg-black/40 backdrop-blur-md border-b-2 border-zinc-700 focus:border-[#dc2626] px-4 py-4 text-xl font-cinematic text-white focus:outline-none transition-all placeholder:text-zinc-700 placeholder:italic text-center rounded-t-md"
                            />
                            <div class="absolute bottom-0 left-0 w-full h-0.5 bg-[#dc2626] scale-x-0 group-focus-within:scale-x-100 transition-transform duration-500 origin-center"></div>
                        </div>
                      </div>
                      <div>
                        <label class="block text-center font-cinematic text-lg text-zinc-400 mb-3 italic">Partner Two</label>
                        <div class="relative group w-full">
                            <input 
                              type="text" 
                              value="${state.p2Name}" 
                              oninput="state.p2Name = this.value; checkSetupValidity()"
                              placeholder="Enter name..."
                              class="w-full bg-black/40 backdrop-blur-md border-b-2 border-zinc-700 focus:border-[#dc2626] px-4 py-4 text-xl font-cinematic text-white focus:outline-none transition-all placeholder:text-zinc-700 placeholder:italic text-center rounded-t-md"
                            />
                            <div class="absolute bottom-0 left-0 w-full h-0.5 bg-[#dc2626] scale-x-0 group-focus-within:scale-x-100 transition-transform duration-500 origin-center"></div>
                        </div>
                      </div>
                    </div>

                    <div class="mt-12 flex flex-col gap-4">
                      <button id="enterStoryBtn" onclick="clickSound(); setScreen('EPISODES');" disabled class="bg-[#b91c1c] text-white hover:bg-[#991b1b] border-b-4 border-[#7f1d1d] hover:border-[#601515] relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 shadow-xl w-full disabled:opacity-50 disabled:cursor-not-allowed">
                        Enter Story
                      </button>
                      <button onclick="setScreen('SPLASH')" class="bg-transparent text-zinc-500 hover:text-[#ef4444] shadow-none hover:bg-white/5 relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 w-full">Back</button>
                    </div>
                  </div>
                </div>
            `;
        }

        // Helper to enable/disable button based on input
        function checkSetupValidity() {
            const btn = document.getElementById('enterStoryBtn');
            if (btn) {
                if (state.p1Name && state.p2Name) {
                    btn.disabled = false;
                } else {
                    btn.disabled = true;
                }
            }
        }

        function renderEpisodes() {
            let episodesHtml = EPISODES.map(ep => `
              <button
                onclick="startEpisode(${ep.id})"
                class="w-full group relative overflow-hidden rounded-lg transition-all duration-300 hover:scale-[1.02] border border-zinc-800 hover:border-[#b91c1c] bg-zinc-900/80 text-left shrink-0"
              >
                <div class="absolute inset-0 bg-gradient-to-r ${ep.color} opacity-20 group-hover:opacity-40 transition-opacity duration-500"></div>
                
                <div class="relative p-6 flex items-center gap-5">
                  <div class="text-3xl opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-transform duration-300">${ep.icon}</div>
                  <div class="flex-1">
                    <h3 class="font-cinematic text-xl text-slate-100 mb-1 group-hover:text-white transition-colors">${ep.title}</h3>
                    <p class="font-ui text-zinc-500 text-[10px] uppercase tracking-wider group-hover:text-[#ef4444] transition-colors">${ep.subtitle}</p>
                  </div>
                  <div class="w-8 h-8 rounded-full border border-zinc-700 flex items-center justify-center group-hover:bg-[#b91c1c] group-hover:border-[#b91c1c] transition-colors">
                     <i data-lucide="play" class="w-3 h-3 text-zinc-500 group-hover:text-white fill-current"></i>
                  </div>
                </div>
              </button>
            `).join('');

            return `
                <div class="relative z-10 flex flex-col h-screen pt-10 pb-10 px-6 max-w-lg mx-auto w-full animate-slide-up-fade">
                  <div class="text-center mb-8 flex-none">
                    <h2 class="font-ui text-[#ef4444] text-xs tracking-[0.3em] uppercase mb-4 font-bold">Select Chapter</h2>
                    <h1 class="font-cinematic font-bold text-white drop-shadow-2xl text-2xl md:text-3xl text-center leading-tight">Your Story</h1>
                  </div>

                  <div class="w-full space-y-5 flex-1 overflow-y-auto no-scrollbar pb-10 px-1">
                    ${episodesHtml}
                  </div>
                </div>
            `;
        }

        function startEpisode(id) {
            clickSound();
            state.currentEpisodeId = id;
            state.currentSceneIndex = 0;
            state.dialogueIndex = 0;
            state.scores = [];
            setScreen('GAME');
        }

        function renderGame() {
            const episode = getEpisode();
            const scene = getScene();
            const currentSpeaker = state.turn === 1 ? state.p1Name : state.p2Name;
            const isChoicePhase = state.dialogueIndex >= scene.dialogue.length;

            // Progress Bars
            const progressBars = episode.scenes.map((_, i) => 
                `<div class="h-1 rounded-full transition-all duration-500 ${i === state.currentSceneIndex ? 'w-6 bg-[#ef4444]' : i < state.currentSceneIndex ? 'w-2 bg-[#7f1d1d]' : 'w-2 bg-zinc-800'}"></div>`
            ).join('');

            // Dialogue Layer Logic
            let dialogueLayerClass = isChoicePhase ? 'opacity-0 pointer-events-none scale-95' : 'opacity-100 scale-100';
            let dialogueContent = '';
            
            if (!isChoicePhase) {
                const step = scene.dialogue[state.dialogueIndex];
                const speakerName = step.speaker === 'Narrator' ? 'Narrator' : (step.speaker === 'p1' ? state.p1Name : state.p2Name);
                
                dialogueContent = `
                   <div class="font-cinematic text-sm text-[#ef4444] mb-6 tracking-widest uppercase relative z-10">
                     ${speakerName}
                   </div>
                   <p class="font-arabic text-2xl text-slate-100 leading-relaxed text-glow px-2 relative z-10" dir="rtl">
                     ${step.text}
                   </p>
                   <div class="mt-8 text-[10px] font-ui text-zinc-600 uppercase tracking-widest animate-pulse relative z-10">Tap to Continue</div>
                `;
            }

            // Choice Layer Logic
            let choiceLayerClass = isChoicePhase ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10';
            
            const choicesHtml = scene.choices.map((choice, idx) => {
                const selected = state.turn === 1 ? state.p1Choice === idx : state.p2Choice === idx;
                const activeClass = selected 
                    ? 'bg-[#7f1d1d] border-[#ef4444] text-white shadow-lg' 
                    : 'bg-zinc-900 border-black text-zinc-400 hover:bg-zinc-800';
                const indicatorClass = selected ? 'bg-[#ef4444]' : 'bg-transparent group-hover:bg-zinc-700';

                return `
                  <button
                    onclick="handleChoice(${idx})"
                    class="w-full text-right p-5 border-b-2 transition-all duration-200 group relative overflow-hidden ${activeClass}"
                  >
                    <div class="absolute left-0 top-0 bottom-0 w-1 transition-all duration-300 ${indicatorClass}"></div>
                    <span class="font-arabic text-lg font-semibold relative z-10 block pr-2" dir="rtl">${choice}</span>
                  </button>
                `;
            }).join('');

            const hasSelected = state.turn === 1 ? state.p1Choice !== null : state.p2Choice !== null;
            let lockButtonHtml = '';
            
            if (hasSelected) {
                lockButtonHtml = `
                  <div class="absolute bottom-4 left-0 right-0 animate-slide-up-fade">
                    <button onclick="lockIn()" class="bg-[#b91c1c] text-white hover:bg-[#991b1b] border-b-4 border-[#7f1d1d] hover:border-[#601515] relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 shadow-xl w-full rounded-none">
                       <i data-lucide="lock" class="w-4 h-4"></i> <span>Lock Answer</span>
                    </button>
                  </div>
                `;
            }

            return `
              <div class="relative z-10 flex flex-col h-screen max-w-md mx-auto w-full overflow-hidden">
                <!-- Top Bar -->
                <div class="pt-10 px-6 flex justify-between items-end mb-8">
                   <span class="font-ui text-[10px] text-zinc-500 tracking-widest uppercase">
                      Scene ${state.currentSceneIndex + 1} <span class="text-zinc-700 mx-2">/</span> ${episode.scenes.length}
                   </span>
                   <div class="flex gap-1">
                    ${progressBars}
                  </div>
                </div>

                <!-- Scene Title -->
                <div class="px-6 text-center mb-6 animate-slide-up-fade">
                   <h2 class="font-arabic font-bold text-2xl md:text-3xl text-white drop-shadow-md" dir="rtl">${scene.name}</h2>
                </div>

                <!-- Main Stage -->
                <div class="flex-1 relative w-full px-6 pb-6">
                  
                  <!-- DIALOGUE LAYER -->
                  <div 
                    onclick="handleDialogueTap()"
                    class="absolute inset-0 z-20 flex flex-col justify-center items-center px-6 transition-all duration-500 cursor-pointer ${dialogueLayerClass}"
                  >
                     <div class="w-full max-w-md bg-black/80 backdrop-blur-xl p-2 rounded-xl shadow-2xl border border-white/10">
                        <div class="border-2 border-dashed border-[#b91c1c]/50 rounded-lg p-6 min-h-[250px] flex flex-col justify-center items-center text-center relative overflow-hidden">
                          ${dialogueContent}
                        </div>
                     </div>
                  </div>

                  <!-- CHOICE LAYER -->
                  <div class="absolute inset-0 z-10 flex flex-col transition-all duration-700 ${choiceLayerClass}">
                    
                    <div class="text-center mb-6">
                       <span class="bg-[#b91c1c] text-white px-3 py-1 rounded text-[10px] font-ui uppercase tracking-widest font-bold shadow-lg">
                          ${currentSpeaker}'s Turn
                       </span>
                    </div>
                    
                    <!-- Question -->
                    <div class="bg-black/40 backdrop-blur-sm p-4 rounded-lg mb-6 text-center">
                       <p class="font-arabic text-lg text-white leading-loose" dir="rtl">"${scene.question}"</p>
                    </div>
                    
                    <!-- Choices Grid -->
                    <div class="flex-1 overflow-y-auto no-scrollbar space-y-3 pb-20">
                      ${choicesHtml}
                    </div>

                    ${lockButtonHtml}
                  </div>

                </div>
              </div>
            `;
        }

        function handleDialogueTap() {
             const scene = getScene();
             if (state.dialogueIndex < scene.dialogue.length) {
                 state.dialogueIndex++;
                 render();
             }
        }

        function handleChoice(index) {
            clickSound();
            if (state.turn === 1) {
                state.p1Choice = index;
            } else {
                state.p2Choice = index;
            }
            render();
        }

        function lockIn() {
            clickSound();
            if (state.turn === 1) {
                setScreen('PASS');
            } else {
                setScreen('REVEAL');
            }
        }

        function renderPass() {
            return `
                <div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-6 text-center animate-slide-up-fade">
                  <div class="w-24 h-24 rounded-full flex items-center justify-center mb-8 bg-zinc-900 border-4 border-[#18181b] relative shadow-2xl">
                    <div class="absolute inset-0 rounded-full border border-[#ef4444] animate-ping opacity-20"></div>
                    <i data-lucide="users" class="w-8 h-8 text-[#ef4444]"></i>
                  </div>
                  
                  <h1 class="font-cinematic font-bold text-white drop-shadow-2xl text-4xl md:text-5xl text-center leading-tight mb-8">Switch Players</h1>
                  
                  <div class="w-full max-w-xs bg-zinc-900/50 p-8 rounded-lg border border-zinc-800 mb-12">
                    <p class="font-cinematic text-xl text-zinc-300 italic mb-6">"Silence is golden."</p>
                    <div class="w-full h-px bg-zinc-800 mb-6"></div>
                    <p class="font-ui text-xs text-zinc-500 uppercase tracking-widest">Pass device to</p>
                    <p class="font-cinematic text-2xl text-[#ef4444] mt-2">${state.p2Name}</p>
                  </div>

                  <div class="w-full max-w-xs">
                    <button onclick="clickSound(); updateState({ turn: 2, dialogueIndex: 999 }); setScreen('GAME');" class="bg-[#b91c1c] text-white hover:bg-[#991b1b] border-b-4 border-[#7f1d1d] hover:border-[#601515] relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 shadow-xl w-full">
                      I am ${state.p2Name}
                    </button>
                  </div>
                </div>
            `;
        }

        function renderReveal() {
            const scene = getScene();
            const p1C = state.p1Choice;
            const p2C = state.p2Choice;
            const isMatch = p1C === p2C;
            const outcome = scene.outcomes[p1C]; // Logic: use the choice selected by P1 to determine outcome text roughly, but match bonus decides score
            // Actually in original code: const outcome = scene.outcomes[isMatch ? p1C : p1C]; (Always p1C)
            
            const matchPercent = isMatch ? 100 : Math.floor(Math.random() * 30) + 40; 
            const isHighMatch = matchPercent >= 85;
            
            // Note: We need to store this result logic temporarily or just calc it when clicking "Deep Dive"
            // For render, we just show visualization
            
            return `
              <div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-6 py-10 max-w-md mx-auto w-full animate-slide-up-fade">
                <div class="text-center mb-10">
                  <span class="font-ui text-[10px] text-[#ef4444] tracking-[0.3em] uppercase mb-3 block font-bold">The Verdict</span>
                  <h1 class="font-cinematic font-bold text-white drop-shadow-2xl text-2xl md:text-3xl text-center leading-tight">${isMatch ? "Perfect Harmony" : "Different Perspectives"}</h1>
                </div>

                <div class="w-full grid grid-cols-2 gap-4 mb-8">
                  <div class="bg-zinc-900/80 p-5 rounded border-t-4 border-[#ef4444] text-center shadow-lg relative overflow-hidden group">
                     <div class="absolute inset-0 bg-gradient-to-b from-[#ef4444]/10 to-transparent opacity-50"></div>
                     <div class="text-[10px] font-ui font-bold text-[#ef4444] mb-3 tracking-widest uppercase relative z-10">${state.p1Name}</div>
                     <div class="font-arabic text-md leading-snug text-white relative z-10" dir="rtl">"${scene.choices[p1C]}"</div>
                  </div>
                  <div class="bg-zinc-900/80 p-5 rounded border-t-4 border-indigo-500 text-center shadow-lg relative overflow-hidden group">
                     <div class="absolute inset-0 bg-gradient-to-b from-indigo-500/10 to-transparent opacity-50"></div>
                     <div class="text-[10px] font-ui font-bold text-indigo-400 mb-3 tracking-widest uppercase relative z-10">${state.p2Name}</div>
                     <div class="font-arabic text-md leading-snug text-white relative z-10" dir="rtl">"${scene.choices[p2C]}"</div>
                  </div>
                </div>

                <div class="glass-panel rounded-lg p-8 md:p-10 relative overflow-hidden w-full mb-10 bg-gradient-to-b from-zinc-900 to-black border-zinc-800">
                   <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
                   <div class="text-center relative z-10">
                     <div class="inline-flex items-center justify-center p-4 rounded-full mb-6 bg-zinc-950 border border-zinc-800 shadow-xl">
                       <i data-lucide="heart" class="w-7 h-7 ${isHighMatch ? 'text-[#ef4444] fill-[#ef4444]' : 'text-zinc-600'}"></i>
                     </div>
                     <h3 class="font-arabic font-bold text-2xl text-white mb-4" dir="rtl">${outcome.title}</h3>
                     <p class="font-arabic text-zinc-400 text-lg leading-loose" dir="rtl">${outcome.description}</p>
                     
                     <div class="mt-8 pt-6 border-t border-white/5 flex justify-center items-center gap-3">
                        <span class="text-[10px] text-zinc-500 font-ui uppercase tracking-widest">Compatibility</span>
                        <span class="font-cinematic font-bold text-3xl ${isHighMatch ? 'text-[#ef4444]' : 'text-zinc-500'}">${matchPercent}%</span>
                     </div>
                   </div>
                </div>

                <button onclick="goToDiscussion()" class="bg-[#b91c1c] text-white hover:bg-[#991b1b] border-b-4 border-[#7f1d1d] hover:border-[#601515] relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 shadow-xl w-full">
                  Deep Dive
                </button>
              </div>
            `;
        }

        function goToDiscussion() {
            clickSound();
            const scene = getScene();
            const p1C = state.p1Choice;
            const p2C = state.p2Choice;
            const isMatch = p1C === p2C;
            const outcome = scene.outcomes[p1C];
            const roundScore = isMatch ? outcome.matchBonus : Math.round(outcome.matchBonus * 0.5);
            state.scores.push(roundScore);
            setScreen('DISCUSSION');
        }

        function renderDiscussion() {
            const scene = getScene();
            return `
              <div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-6 text-center animate-slide-up-fade">
                <div class="w-16 h-16 rounded-full flex items-center justify-center mb-8 bg-zinc-900 border border-zinc-800 shadow-2xl">
                  <i data-lucide="message-circle" class="w-6 h-6 text-[#ef4444]"></i>
                </div>
                
                <h2 class="font-cinematic text-4xl text-white mb-10">Real Talk</h2>
                
                <div class="glass-panel rounded-lg p-8 md:p-10 relative overflow-hidden w-full max-w-md mb-12 bg-zinc-900/50 border-[#ef4444]/30">
                   <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
                   <p class="text-[10px] text-[#ef4444] font-ui font-bold tracking-[0.2em] mb-6 uppercase">Discussion Topic</p>
                   <p class="font-arabic text-2xl text-white leading-loose drop-shadow-lg" dir="rtl">
                     "${scene.discussionTopic}"
                   </p>
                   <div class="mt-10 p-4 bg-black/40 rounded border border-white/5">
                     <p class="text-xs font-cinematic text-zinc-500 italic">"Listen to understand, not to reply."</p>
                   </div>
                </div>

                <div class="w-full max-w-xs">
                    <button onclick="nextScene()" class="bg-zinc-800 text-white hover:bg-zinc-700 border-b-4 border-zinc-950 relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 shadow-xl w-full">
                      Continue Story
                    </button>
                </div>
              </div>
            `;
        }

        function nextScene() {
            clickSound();
            const ep = getEpisode();
            if (state.currentSceneIndex < ep.scenes.length - 1) {
                updateState({ 
                  currentSceneIndex: state.currentSceneIndex + 1,
                  dialogueIndex: 0,
                  p1Choice: null,
                  p2Choice: null,
                  turn: 1,
                });
            } else {
                setScreen('FINAL');
            }
        }

        function renderFinal() {
            const totalScore = state.scores.reduce((a, b) => a + b, 0);
            const maxScore = getEpisode().scenes.length * 100;
            const percentage = Math.round((totalScore / maxScore) * 100);

            let title = "The Journey Ends";
            let desc = "You have the foundation. Now build the castle.";
            
            if (percentage > 90) { title = "Soulmates"; desc = "Your hearts speak the same language."; }
            else if (percentage > 75) { title = "Beautiful Harmony"; desc = "A strong resonance exists between you."; }
            else if (percentage > 60) { title = "Complementary"; desc = "Your differences will make you stronger."; }

            return `
              <div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-6 text-center animate-slide-up-fade">
                <div class="mb-10 relative">
                  <div class="absolute inset-0 bg-[#ef4444] blur-[80px] opacity-20"></div>
                  <i data-lucide="sparkles" class="w-16 h-16 text-[#ef4444] animate-pulse relative z-10"></i>
                </div>
                
                <div class="font-ui text-zinc-500 text-[10px] tracking-[0.3em] uppercase mb-4 font-bold">Episode Complete</div>
                <h1 class="font-cinematic font-bold text-white drop-shadow-2xl text-4xl md:text-5xl text-center leading-tight mb-6">${title}</h1>
                <p class="font-cinematic text-xl text-zinc-400 leading-relaxed max-w-sm mx-auto mb-12 italic">"${desc}"</p>
                
                <div class="w-40 h-40 rounded-full flex flex-col items-center justify-center mx-auto border-4 border-[#b91c1c] bg-zinc-900 shadow-[0_0_30px_rgba(220,38,38,0.2)] mb-12 relative">
                  <div class="text-[10px] text-zinc-500 uppercase tracking-widest mb-1 font-ui">Match</div>
                  <div class="text-4xl font-cinematic font-bold text-white">${percentage}%</div>
                </div>

                <div class="flex flex-col gap-4 w-full max-w-xs">
                  <button onclick="clickSound(); setScreen('EPISODES');" class="bg-[#b91c1c] text-white hover:bg-[#991b1b] border-b-4 border-[#7f1d1d] hover:border-[#601515] relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 shadow-xl w-full">Next Chapter</button>
                  <button onclick="resetGame()" class="bg-transparent text-zinc-500 hover:text-[#ef4444] shadow-none hover:bg-white/5 relative font-ui font-bold text-sm tracking-[0.15em] uppercase py-4 px-6 rounded-md transition-all duration-200 transform active:scale-95 flex items-center justify-center gap-3 w-full">
                    <i data-lucide="rotate-ccw" class="w-4 h-4 mr-2"></i> Exit to Title
                  </button>
                </div>
              </div>
            `;
        }

        function resetGame() {
            Object.assign(state, JSON.parse(JSON.stringify(INITIAL_STATE)));
            setScreen('SPLASH');
        }

        // --- MAIN RENDER LOOP ---
        function render() {
            const app = document.getElementById('app');
            let content = '';

            switch(state.screen) {
                case 'SPLASH': content = renderSplash(); break;
                case 'SETUP': content = renderSetup(); break;
                case 'EPISODES': content = renderEpisodes(); break;
                case 'GAME': content = renderGame(); break;
                case 'PASS': content = renderPass(); break;
                case 'REVEAL': content = renderReveal(); break;
                case 'DISCUSSION': content = renderDiscussion(); break;
                case 'FINAL': content = renderFinal(); break;
            }

            app.innerHTML = content;
            lucide.createIcons();
            
            // Re-apply focus if needed (simplified here just to ensure input focus doesn't get totally lost if we were re-rendering heavily, though we optimized setup to not re-render)
        }

        // --- HEART ANIMATION ---
        function initHearts() {
            const canvas = document.getElementById('heartCanvas');
            const ctx = canvas.getContext('2d');
            
            let width = window.innerWidth;
            let height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;

            const hearts = [];
            const colors = ['#7f1d1d', '#991b1b', '#b91c1c', '#dc2626', '#ef4444']; 

            class Heart {
              constructor(initialY) {
                this.x = Math.random() * width;
                this.y = initialY ?? height + Math.random() * 100;
                this.size = Math.random() * 15 + 5; 
                this.speedY = Math.random() * 1.2 + 0.4;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.opacity = Math.random() * 0.5 + 0.1;
                this.wobble = Math.random() * Math.PI * 2;
                this.wobbleSpeed = Math.random() * 0.02;
              }

              update() {
                this.y -= this.speedY;
                this.wobble += this.wobbleSpeed;
                this.x += Math.sin(this.wobble) * 0.5;

                if (this.y < -50) {
                  this.y = height + 50;
                  this.x = Math.random() * width;
                }
              }

              draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                const topCurveHeight = this.size * 0.3;
                ctx.moveTo(this.x, this.y + topCurveHeight);
                ctx.bezierCurveTo(
                  this.x, this.y, 
                  this.x - this.size / 2, this.y, 
                  this.x - this.size / 2, this.y + topCurveHeight
                );
                ctx.bezierCurveTo(
                  this.x - this.size / 2, this.y + (this.size + topCurveHeight) / 2, 
                  this.x, this.y + (this.size + topCurveHeight) / 2, 
                  this.x, this.y + this.size
                );
                ctx.bezierCurveTo(
                  this.x, this.y + (this.size + topCurveHeight) / 2, 
                  this.x + this.size / 2, this.y + (this.size + topCurveHeight) / 2, 
                  this.x + this.size / 2, this.y + topCurveHeight
                );
                ctx.bezierCurveTo(
                  this.x + this.size / 2, this.y, 
                  this.x, this.y, 
                  this.x, this.y + topCurveHeight
                );
                ctx.closePath();
                ctx.fill();
                ctx.restore();
              }
            }

            for (let i = 0; i < 60; i++) {
              hearts.push(new Heart(Math.random() * height));
            }

            function animate() {
              ctx.clearRect(0, 0, width, height);
              hearts.forEach(h => {
                h.update();
                h.draw();
              });
              requestAnimationFrame(animate);
            }

            animate();

            window.addEventListener('resize', () => {
              width = window.innerWidth;
              height = window.innerHeight;
              canvas.width = width;
              canvas.height = height;
            });
        }

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            initHearts();
            render();
        });

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>