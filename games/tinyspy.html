<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tiny Spy Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --accent-color: #00adb5;
            --text-color: #eeeeee;
            --danger-color: #ff2e63;
            --glass-bg: rgba(255, 255, 255, 0.08);
            --modal-bg: rgba(0, 0, 0, 0.9);
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- TYPOGRAPHY --- */
        h1, h2, h3 { margin: 0; font-weight: 700; }
        h1 { font-size: 3rem; color: var(--accent-color); z-index: 2; position: relative; }
        h2 { font-size: 1.8rem; margin-bottom: 20px; }
        p { color: #aaa; font-size: 1.1rem; line-height: 1.6; }
        .arabic-text { font-family: 'Cairo', sans-serif; direction: rtl; }

        /* --- SCREENS --- */
        .screen { display: none; width: 90%; max-width: 450px; text-align: center; padding-bottom: 50px; position: relative; z-index: 10; }
        .active { display: block; }

        /* --- CREDITS FOOTER --- */
        .credits {
            margin-top: 40px;
            font-size: 0.8rem;
            color: #666;
            z-index: 20;
            position: relative;
        }
        .credits a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }
        .credits a:hover {
            color: white;
            text-decoration: underline;
        }

        /* --- BACKGROUND ANIMATION (Splash) --- */
        .bg-cards {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 0; pointer-events: none;
        }
        .bg-card {
            position: absolute; width: 60px; height: 80px; border: 2px dashed rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.02); 
            opacity: 0; 
            animation: floatUp 10s infinite linear;
        }
        @keyframes floatUp {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        /* --- BUTTONS --- */
        button {
            background-color: var(--accent-color);
            color: #fff; border: none; padding: 18px; border-radius: 0; /* Square/Sharp */
            font-size: 1.2rem; font-weight: bold; margin-top: 15px;
            cursor: pointer; width: 100%; 
            position: relative; overflow: hidden;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: transform 0.1s, filter 0.2s;
        }
        button:active { transform: scale(0.98); }
        button.secondary { background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); }
        button.danger { background-color: var(--danger-color); }
        button.small-btn { padding: 10px; font-size: 0.9rem; width: auto; display: inline-block; margin: 5px; }

        /* --- INPUTS --- */
        .input-group { background: var(--glass-bg); padding: 20px; margin-bottom: 15px; text-align: left; border-left: 4px solid var(--accent-color); }
        .input-group label { font-size: 0.9rem; color: var(--accent-color); display: block; margin-bottom: 5px;}
        input[type="text"] {
            width: 100%; padding: 12px; border: 1px solid #444; background: #222; color: white; font-size: 1rem; outline: none;
        }
        input[type=range] { width: 100%; accent-color: var(--accent-color); cursor: pointer; }
        
        /* Checkbox Switch */
        .switch-container { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* --- CARD STYLE --- */
        .card-container { perspective: 1000px; width: 100%; height: 320px; margin: 30px auto; cursor: pointer; }
        .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.is-flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--card-bg);
            border-radius: 0; /* Not rounded */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        /* Dashed Inner Border Effect */
        .card-face::after {
            content: ''; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 2px dashed var(--accent-color); pointer-events: none;
        }

        .card-back { background: #222; }
        .card-front { transform: rotateY(180deg); background: #222; }
        .card-front::after { border-color: #555; }
        
        .role-word { font-size: 2.5rem; color: var(--accent-color); padding: 20px; z-index: 2; }
        .big-icon { font-size: 4rem; z-index: 2; }

        /* --- JUDGEMENT CARDS --- */
        .judge-option {
            background: rgba(255,255,255,0.05);
            border: 1px dashed #555;
            padding: 15px;
            margin-bottom: 10px;
            color: #eee;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .judge-option:hover {
            border-color: var(--accent-color);
            background: rgba(0, 173, 181, 0.1);
        }
        .judge-option.selected {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: #fff;
        }

        /* --- CUSTOM MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-bg); z-index: 100; display: none;
            align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: #1a1a1a; width: 85%; max-width: 350px; padding: 30px 20px;
            border: 1px solid var(--accent-color); box-shadow: 0 0 20px rgba(0, 173, 181, 0.2);
            text-align: center; animation: zoomIn 0.2s ease-out;
        }
        @keyframes zoomIn { from {transform: scale(0.8); opacity:0;} to {transform: scale(1); opacity:1;} }
        
        .modal-btns { display: flex; gap: 10px; margin-top: 20px; }

        /* --- GRID --- */
        .vote-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .vote-btn { margin: 0; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid #444; }
        .vote-btn:hover { border-color: var(--accent-color); background: rgba(0,173,181,0.1); }

    </style>
</head>
<body>

    <!-- BACKGROUND ANIMATION -->
    <div class="bg-cards" id="bgAnim"></div>

    <!-- 1. SPLASH SCREEN -->
    <section id="screen-splash" class="screen active animate__animated animate__fadeIn">
        <h1>Tiny Spy</h1>
        <p style="letter-spacing: 2px; text-transform: uppercase; font-size: 0.8rem;">Social Deduction Game</p>
        <div style="margin: 40px 0;">
            <div style="font-size: 4rem;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        </div>
        <button onclick="startSetup()">New Game</button>
        
        <!-- DEVELOPER CREDIT -->
        <div class="credits">
            Developed by <a href="https://mfouadbakr.github.io/portfolio/index.html" target="_blank">Mohamed Bakr</a>
        </div>
    </section>

    <!-- 2. SETUP SCREEN -->
    <section id="screen-setup" class="screen animate__animated animate__fadeIn">
        <h2>Game Setup</h2>
        
        <div class="input-group">
            <label>Number of Players: <span id="pVal" style="color:white; font-weight:bold;">3</span></label>
            <input type="range" min="3" max="10" value="3" id="pCount" oninput="document.getElementById('pVal').innerText = this.value">
        </div>

        <div class="input-group">
            <div class="switch-container">
                <label>Spy knows they are the Spy?</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="spyAware" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <p style="font-size: 0.8rem; margin: 5px 0 0 0;">If OFF, Spy's word looks identical to citizens (Hard Mode).</p>
        </div>

        <button onclick="goToNames()">Next</button>
    </section>

    <!-- 3. NAMES SCREEN -->
    <section id="screen-names" class="screen animate__animated animate__fadeIn">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Players</h2>
            <button class="small-btn secondary" onclick="rerollCategory()" style="width: auto;">üé≤ Shuffle Words</button>
        </div>
        
        <p id="catPreview" style="font-size: 0.8rem; color: var(--accent-color); margin-bottom: 10px;">Category: Random</p>

        <div id="nameInputsContainer" style="max-height: 40vh; overflow-y: auto; padding-right:5px;"></div>
        
        <button onclick="initGame()">Start Game</button>
    </section>

    <!-- 4. PASS PHONE SCREEN -->
    <section id="screen-pass" class="screen animate__animated animate__fadeIn">
        <h2 style="color: #666">Pass phone to:</h2>
        <h1 id="passNameDisplay" class="arabic-text" style="font-size: 2.5rem; margin: 30px 0;">Name</h1>
        <div style="font-size: 3rem; animation: pulse 2s infinite;">üì±</div>
        <p>Keep the screen hidden!</p>
        <button onclick="showRevealScreen()">I am <span id="btnPassName">Name</span></button>
    </section>

    <!-- 5. REVEAL CARD SCREEN -->
    <section id="screen-reveal" class="screen animate__animated animate__fadeIn">
        <h2 id="revealNameHeader" class="arabic-text">Player Name</h2>
        
        <div class="card-container" onclick="toggleCard()">
            <div class="card" id="roleCard">
                <!-- Back -->
                <div class="card-face card-back">
                    <span class="big-icon">üëÅÔ∏è</span>
                    <span style="z-index:2; margin-top:10px; font-weight:bold; letter-spacing:1px;">TAP TO REVEAL</span>
                </div>
                <!-- Front -->
                <div class="card-face card-front">
                    <p style="margin:0; font-size: 0.9rem; color:#888; z-index:2;">YOUR WORD</p>
                    <div id="roleWord" class="role-word arabic-text">Word</div>
                    <span style="z-index:2; position:absolute; bottom:20px; font-size:0.8rem; opacity:0.5;">TAP TO HIDE</span>
                </div>
            </div>
        </div>

        <button id="nextBtn" style="display:none;" onclick="finishTurn()">Pass to Next Player</button>
    </section>

    <!-- 6. MISSION / TIMER SCREEN -->
    <section id="screen-hint" class="screen animate__animated animate__fadeIn">
        <h2>The Mission</h2>
        <div class="input-group" style="text-align:center;">
            <p style="margin:0;">Category</p>
            <h2 id="arabicHint" class="arabic-text" style="color: var(--accent-color); margin-top:5px;"></h2>
        </div>
        
        <div style="margin: 20px 0;">
            <p id="timer" style="font-size: 3.5rem; font-weight:bold; margin:0; color: white;">03:00</p>
        </div>

        <button id="btnTimer" onclick="toggleTimer()">Start Timer</button>
        <button class="secondary" onclick="prepareVote()">Stop & Vote</button>
    </section>

    <!-- 7. VOTE SCREEN -->
    <section id="screen-vote" class="screen animate__animated animate__fadeIn">
        <h2 style="color: var(--danger-color)">Who is the Spy?</h2>
        <p>Tap a name to accuse them.</p>
        <div id="voteBtns" class="vote-grid"></div>
        <button class="secondary" style="margin-top:30px" onclick="navTo('screen-hint')">Back to Timer</button>
    </section>

    <!-- 8. RESULT SCREEN -->
    <section id="screen-result" class="screen animate__animated animate__fadeIn">
        <h1 id="resTitle">Result</h1>
        
        <div class="input-group" style="text-align: center;">
            <p>The Spy was:</p>
            <h2 id="spyNameDisplay" class="arabic-text" style="color:var(--danger-color)">Name</h2>
            <hr style="border: 0; border-top: 1px dashed #444; margin: 15px 0;">
            <p>The Word was:</p>
            <h2 id="citizenWordDisplay" class="arabic-text" style="color:var(--accent-color)">Word</h2>
        </div>

        <button onclick="showJudgement()">See Judgement Choices ‚öñÔ∏è</button>
    </section>

    <!-- 9. JUDGEMENT SCREEN -->
    <section id="screen-judgement" class="screen animate__animated animate__fadeIn">
        <h2 id="judgeContext">Choose one:</h2>
        
        <div id="judgementList" style="margin-top:20px;">
            <!-- Choices injected here -->
        </div>

        <button onclick="startSetup()">Start New Game</button>
    </section>

    <!-- CUSTOM MODAL -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modalTitle">Confirm</h3>
            <p id="modalMsg">Are you sure?</p>
            <div class="modal-btns">
                <button class="secondary" onclick="closeModal()">Cancel</button>
                <button id="modalConfirmBtn">Yes</button>
            </div>
        </div>
    </div>

    <script>
        // --- ANIMATION SETUP ---
        function createBgCards() {
            const container = document.getElementById('bgAnim');
            for(let i=0; i<12; i++) {
                let div = document.createElement('div');
                div.className = 'bg-card';
                div.style.left = Math.random() * 90 + '%';
                div.style.animationDuration = (Math.random() * 8 + 8) + 's';
                div.style.animationDelay = (Math.random() * 8) + 's';
                container.appendChild(div);
            }
        }
        createBgCards();

        // --- DATA ---
        const wordPackages = [
            { common: "ÿµŸÑÿßÿ© ÿßŸÑŸÅÿ¨ÿ±", spy: "ÿµŸÑÿßÿ© ÿßŸÑÿ¨ŸÖÿπÿ©", hint: "ÿπÿ®ÿßÿØÿ©" },
            { common: "ŸÉÿ¥ÿ±Ÿä", spy: "ŸÖŸÉÿ±ŸàŸÜÿ© ÿ®ÿ¥ÿßŸÖŸäŸÑ", hint: "ÿ£ŸÉŸÑ ŸÖÿµÿ±Ÿä" },
            { common: "ÿßŸÑÿ£Ÿáÿ±ÿßŸÖÿßÿ™", spy: "ÿ£ÿ®Ÿà ÿßŸÑŸáŸàŸÑ", hint: "ÿ¢ÿ´ÿßÿ±" },
            { common: "ÿßŸÑÿ≥ÿßÿ≠ŸÑ ÿßŸÑÿ¥ŸÖÿßŸÑŸä", spy: "ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©", hint: "ŸÖÿµŸäŸÅ" },
            { common: "ŸÇŸáŸàÿ© ÿ™ÿ±ŸÉŸä", spy: "ŸÜÿ≥ŸÉÿßŸÅŸäŸá", hint: "ŸÖÿ¥ÿ±Ÿàÿ®" },
            { common: "ŸÖŸäŸÉÿ±Ÿàÿ®ÿßÿµ", spy: "ÿ™ŸàŸÉÿ™ŸàŸÉ", hint: "ŸÖŸàÿßÿµŸÑÿßÿ™" },
            { common: "ŸÅŸäÿ≥ÿ®ŸàŸÉ", spy: "ÿßŸÜÿ≥ÿ™ÿ¨ÿ±ÿßŸÖ", hint: "ÿ™ÿ∑ÿ®ŸäŸÇ" },
            { common: "ÿ®ÿ∑ŸäÿÆ", spy: "ÿ¥ŸÖÿßŸÖ", hint: "ŸÅÿßŸÉŸáÿ©" },
            { common: "ÿ´ŸÑÿßÿ¨ÿ©", spy: "ÿ∫ÿ≥ÿßŸÑÿ©", hint: "ÿ¨Ÿáÿßÿ≤ ŸÖŸÜÿ≤ŸÑŸä" },
            { common: "ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±", spy: "ÿπŸäÿØ ÿßŸÑÿ£ÿ∂ÿ≠Ÿâ", hint: "ŸÖŸÜÿßÿ≥ÿ®ÿ©" },
            { common: "ŸÖÿ≠ŸÖÿØ ÿµŸÑÿßÿ≠", spy: "ŸÖŸäÿ≥Ÿä", hint: "ŸÑÿßÿπÿ® ŸÉÿ±ÿ©" },
            { common: "ÿπŸÖÿ±Ÿà ÿØŸäÿßÿ®", spy: "ÿ™ÿßŸÖÿ± ÿ≠ÿ≥ŸÜŸä", hint: "ŸÖÿ∫ŸÜŸä" },
            { common: "ŸÅŸàŸÑ Ÿàÿ∑ÿπŸÖŸäÿ©", spy: "ÿ¨ÿ®ŸÜÿ© Ÿàÿ®ÿ∑ŸäÿÆ", hint: "ŸÅÿ∑ÿßÿ±" },
            { common: "ÿßŸÑŸÇŸÑÿπÿ©", spy: "ÿ®ÿ±ÿ¨ ÿßŸÑŸÇÿßŸáÿ±ÿ©", hint: "ŸÖŸÉÿßŸÜ ÿ≥Ÿäÿßÿ≠Ÿä" },
            { common: "ŸÇÿ∑ÿ©", spy: "ŸÉŸÑÿ®", hint: "ÿ≠ŸäŸàÿßŸÜ" },
            { common: "ÿ¥Ÿäÿ®ÿ≥Ÿä", spy: "ÿØÿ±Ÿäÿ™Ÿàÿ≥", hint: "ÿ≥ŸÜÿßŸÉÿ≥" },
            { common: "ŸÜÿ™ŸÅŸÑŸäŸÉÿ≥", spy: "ÿ¥ÿßŸáÿØ", hint: "ŸÖŸÜÿµÿ© ÿ£ŸÅŸÑÿßŸÖ" },
            { common: "ÿ¨ÿßŸÖÿπÿ© ÿßŸÑŸÇÿßŸáÿ±ÿ©", spy: "ÿßŸÑÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ£ŸÖÿ±ŸäŸÉŸäÿ©", hint: "ÿ™ÿπŸÑŸäŸÖ" },
            { common: "ÿ¥ÿßŸä ÿ®ŸÑÿ®ŸÜ", spy: "ÿ¥ÿßŸä ÿ≥ÿßÿØÿ©", hint: "ŸÖÿ≤ÿßÿ¨" },
            { common: "ÿßŸÑŸÖÿ∑ÿßÿ±", spy: "ŸÖÿ≠ÿ∑ÿ© ÿßŸÑŸÇÿ∑ÿßÿ±", hint: "ÿ≥ŸÅÿ±" },
            { common: "ÿ®Ÿäÿ™ÿ≤ÿß", spy: "ŸÉÿ±Ÿäÿ®", hint: "ÿ£ŸÉŸÑ ÿ≥ÿ±Ÿäÿπ" },
            { common: "ÿßŸÑÿ≤ŸÖÿßŸÑŸÉ", spy: "ÿßŸÑÿ£ŸáŸÑŸä", hint: "ŸÜÿßÿØŸä" },
            { common: "ÿØŸÉÿ™Ÿàÿ± ÿ£ÿ≥ŸÜÿßŸÜ", spy: "ÿØŸÉÿ™Ÿàÿ± ÿµŸäÿØŸÑŸä", hint: "ŸÖŸáŸÜÿ©" },
            { common: "ÿ¨Ÿäÿ™ÿßÿ±", spy: "ÿ®ŸäÿßŸÜŸà", hint: "ŸÖŸàÿ≥ŸäŸÇŸâ" },
            { common: "ÿßŸÑÿµŸäŸÅ", spy: "ÿßŸÑÿ¥ÿ™ÿßÿ°", hint: "ŸÅÿµŸÑ" },
            { common: "ŸÖŸÑŸàÿÆŸäÿ©", spy: "ÿ®ÿßŸÖŸäÿ©", hint: "ÿÆÿ∂ÿßÿ±" },
            { common: "50 ÿ¨ŸÜŸäÿ©", spy: "100 ÿ¨ŸÜŸäÿ©", hint: "ŸÅŸÑŸàÿ≥" },
            { common: "ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±", spy: "ŸÜŸáÿ± ÿßŸÑŸÜŸäŸÑ", hint: "ŸÖŸäÿ©" },
            { common: "ÿßŸäŸÅŸàŸÜ", spy: "ÿ≥ÿßŸÖÿ≥ŸàŸÜÿ¨", hint: "ŸÖŸàÿ®ÿßŸäŸÑ" },
            { common: "ÿ¨ŸäŸÖ (Gym)", spy: "ŸÖŸÑÿπÿ® ŸÉÿ±ÿ©", hint: "ÿ±Ÿäÿßÿ∂ÿ©" },
            { common: "ÿ≥Ÿàÿ¥Ÿä", spy: "ÿ≥ŸÖŸÉ ŸÖÿ¥ŸàŸä", hint: "ÿ£ŸÉŸÑÿ© ÿ®ÿ≠ÿ±Ÿäÿ©" },
            { common: "ŸÖÿ™ÿ±Ÿà", spy: "ÿ™ÿ±ÿßŸÖ", hint: "ŸÖŸàÿßÿµŸÑÿßÿ™ ÿπÿßŸÖÿ©" }
        ];

        // Safe Judgements (Choices)
        const judgementsSpyLost = [
            "Ÿäÿπÿ≤ŸÖ ÿßŸÑŸÜÿßÿ≥ ŸÉŸÑŸáÿß ÿπŸÑŸâ ŸÉŸÜÿ≤",
            "Ÿäÿ™ŸÉŸÑŸÖ ŸÑÿ∫ÿ© ÿπÿ±ÿ®Ÿäÿ© ŸÅÿµÿ≠Ÿâ ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑÿ¨ÿßŸäÿ©",
            "ŸÖŸÖŸÜŸàÿπ Ÿäÿ≥ÿ™ÿÆÿØŸÖ ÿµÿ®ÿßÿπ ÿßŸÑÿ•ÿ®ŸáÿßŸÖ ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑÿ¨ÿßŸäÿ©",
            "ŸäŸÇŸàŸÑ ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿßŸÑÿ£ÿ®ÿ¨ÿØŸäÿ© ÿ®ÿßŸÑÿπŸÉÿ≥",
            "ŸäŸÇŸÅ ÿπŸÑŸâ ÿ±ÿ¨ŸÑ Ÿàÿßÿ≠ÿØÿ© ŸÑŸÖÿØÿ© ÿØŸÇŸäŸÇÿ©",
            "ŸÖŸÖŸÜŸàÿπ Ÿäÿ™ŸÉŸÑŸÖ ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑÿ¨ÿßŸäÿ© ÿ∫Ÿäÿ± ŸÑŸÖÿß ÿ≠ÿØ Ÿäÿ≥ÿ£ŸÑŸá",
            "Ÿäÿ≠ŸÉŸä ŸÜŸÉÿ™ÿ© ÿ®ÿßŸäÿÆÿ© ŸàŸÑÿßÿ≤ŸÖ ÿßŸÑŸÜÿßÿ≥ ÿ™ÿ∂ÿ≠ŸÉ",
            "Ÿäÿµÿ® ŸÖŸäÿ© ŸÑŸÑŸÜÿßÿ≥ ŸÉŸÑŸáÿß",
            "Ÿäÿ∫ŸÜŸä ÿ£ÿ∫ŸÜŸäÿ© ÿ£ÿ∑ŸÅÿßŸÑ ÿ®ÿµŸàÿ™ ÿπÿßŸÑŸä",
            "ŸäÿπŸÖŸÑ 10 ÿπÿØÿßÿ™ ÿ∂ÿ∫ÿ∑"
        ];

        const judgementsSpyWon = [
            "ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥ ŸäÿÆÿ™ÿßÿ± Ÿàÿßÿ≠ÿØ ŸäŸÅÿ∂ŸÑ ŸàÿßŸÇŸÅ ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑÿ¨ÿßŸäÿ©",
            "ÿßŸÑŸÉŸÑ ŸäŸÇŸàŸÑ ŸÑŸÑÿ¨ÿßÿ≥Ÿàÿ≥ 'Ÿäÿß ÿ®ÿßÿ¥ÿß' ŸÇÿ®ŸÑ ŸÖÿß ŸäŸÉŸÑŸÖŸá",
            "ÿßŸÑŸÉŸÑ ŸäÿØŸÅÿπ ŸÑŸÑÿ¨ÿßÿ≥Ÿàÿ≥ 5 ÿ¨ŸÜŸäÿ© (ÿ£Ÿà ÿπŸÖŸÑÿ© ÿ±ŸÖÿ≤Ÿäÿ©)",
            "ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥ ŸäÿÆÿ™ÿßÿ± ŸÖŸÉÿßŸÜ ŸÉŸÑ Ÿàÿßÿ≠ÿØ ŸäŸÇÿπÿØ ŸÅŸäŸÜ",
            "ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥ ŸÖÿπŸÅŸä ŸÖŸÜ ÿßŸÑŸÉŸÑÿßŸÖ ÿ£ŸàŸÑ ÿØŸÇŸäŸÇÿ© ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑÿ¨ÿßŸäÿ©",
            "ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥ ŸäÿÆÿ™ÿßÿ± Ÿàÿßÿ≠ÿØ ŸÖŸäÿ™ŸÉŸÑŸÖÿ¥ ŸÑŸÖÿØÿ© ÿØŸÇŸäŸÇÿ™ŸäŸÜ",
            "ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥ ŸäÿØŸä ŸÑŸÇÿ® ŸÑŸÉŸÑ Ÿàÿßÿ≠ÿØ ŸàÿßŸÑŸÉŸÑ ŸäŸÜÿßÿØŸä ÿ®ŸäŸá"
        ];

        // --- STATE ---
        let state = { 
            players: [], 
            spyIdx: 0, 
            currentIdx: 0, 
            pkg: null, 
            spyAware: true,
            timerTime: 180, 
            interval: null,
            timerRunning: false,
            spyCaught: false
        };

        // --- CORE FUNCTIONS ---

        function navTo(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const el = document.getElementById(id);
            el.classList.remove('animate__fadeIn');
            void el.offsetWidth; 
            el.classList.add('active', 'animate__fadeIn');
        }

        function startSetup() {
            // Full Screen Request
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => console.log(err));
            }
            navTo('screen-setup');
        }

        function goToNames() {
            state.spyAware = document.getElementById('spyAware').checked;
            const count = document.getElementById('pCount').value;
            const container = document.getElementById('nameInputsContainer');
            container.innerHTML = '';
            for(let i=1; i<=count; i++) {
                container.innerHTML += `
                <div class="input-group">
                    <label>Player ${i}</label>
                    <input type="text" class="p-name" placeholder="Name" value="Player ${i}" onfocus="this.select()">
                </div>`;
            }
            rerollCategory(); // Pick initial word
            navTo('screen-names');
        }

        function rerollCategory() {
            state.pkg = wordPackages[Math.floor(Math.random() * wordPackages.length)];
            document.getElementById('catPreview').innerText = "Category: " + state.pkg.hint;
        }

        function initGame() {
            const inputs = document.querySelectorAll('.p-name');
            state.players = Array.from(inputs).map(i => i.value.trim() || "Player " + (Math.random()*100).toFixed(0));
            state.spyIdx = Math.floor(Math.random() * state.players.length);
            state.currentIdx = 0;
            state.timerTime = 60 * Math.max(3, Math.floor(state.players.length * 0.8));
            state.spyCaught = false;

            setupPassScreen();
        }

        // --- GAME LOOP ---

        function setupPassScreen() {
            const currentPlayer = state.players[state.currentIdx];
            document.getElementById('passNameDisplay').innerText = currentPlayer;
            document.getElementById('btnPassName').innerText = currentPlayer;
            navTo('screen-pass');
        }

        function showRevealScreen() {
            const currentPlayer = state.players[state.currentIdx];
            const isSpy = (state.currentIdx === state.spyIdx);
            
            document.getElementById('revealNameHeader').innerText = currentPlayer;
            document.getElementById('roleCard').classList.remove('is-flipped');
            document.getElementById('nextBtn').style.display = 'none';

            // Logic for Spy Awareness
            const wordEl = document.getElementById('roleWord');
            
            if (isSpy) {
                wordEl.innerText = state.pkg.spy;
                if (state.spyAware) {
                    // Spy Knows: Red Color
                    wordEl.style.color = "var(--danger-color)";
                } else {
                    // Spy Doesn't Know: Standard Color
                    wordEl.style.color = "var(--accent-color)";
                }
            } else {
                wordEl.innerText = state.pkg.common;
                wordEl.style.color = "var(--accent-color)";
            }

            navTo('screen-reveal');
        }

        function toggleCard() {
            const card = document.getElementById('roleCard');
            const isFlipped = card.classList.contains('is-flipped');
            
            if(isFlipped) {
                card.classList.remove('is-flipped');
                setTimeout(() => {
                    document.getElementById('nextBtn').style.display = 'block';
                }, 200);
            } else {
                card.classList.add('is-flipped');
            }
        }

        function finishTurn() {
            state.currentIdx++;
            if(state.currentIdx < state.players.length) {
                setupPassScreen();
            } else {
                document.getElementById('arabicHint').innerText = state.pkg.hint;
                updateTimerDisplay();
                navTo('screen-hint');
            }
        }

        // --- TIMER & VOTING ---

        function toggleTimer() {
            const btn = document.getElementById('btnTimer');
            if(state.timerRunning) {
                clearInterval(state.interval);
                state.timerRunning = false;
                btn.innerText = "Resume";
                btn.classList.remove('danger');
            } else {
                state.timerRunning = true;
                btn.innerText = "Pause";
                btn.classList.add('danger');
                state.interval = setInterval(() => {
                    state.timerTime--;
                    updateTimerDisplay();
                    if(state.timerTime <= 0) {
                        clearInterval(state.interval);
                        state.timerRunning = false;
                        btn.innerText = "Time's Up!";
                    }
                }, 1000);
            }
        }

        function updateTimerDisplay() {
            const m = Math.floor(state.timerTime / 60);
            const s = state.timerTime % 60;
            document.getElementById('timer').innerText = 
                `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
        }

        function prepareVote() {
            if(state.timerRunning) toggleTimer();
            const container = document.getElementById('voteBtns');
            container.innerHTML = '';
            state.players.forEach((p, i) => {
                const btn = document.createElement('button');
                btn.className = 'vote-btn';
                btn.innerText = p;
                btn.onclick = () => confirmAccusation(i);
                container.appendChild(btn);
            });
            navTo('screen-vote');
        }

        // --- MODAL LOGIC ---
        function openModal(title, msg, callback) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMsg').innerText = msg;
            
            const yesBtn = document.getElementById('modalConfirmBtn');
            const newBtn = yesBtn.cloneNode(true);
            yesBtn.parentNode.replaceChild(newBtn, yesBtn);
            
            newBtn.onclick = () => {
                callback();
                closeModal();
            };
            
            document.getElementById('customModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('customModal').style.display = 'none';
        }

        function confirmAccusation(idx) {
            openModal("Accuse Player?", `Are you sure ${state.players[idx]} is the Spy?`, () => {
                showResult(idx);
            });
        }

        // --- RESULTS & JUDGEMENT ---

        function showResult(votedIdx) {
            state.spyCaught = (votedIdx === state.spyIdx);
            
            document.getElementById('resTitle').innerText = state.spyCaught ? "Citizens Win! üéâ" : "Spy Wins! üïµÔ∏è";
            document.getElementById('resTitle').style.color = state.spyCaught ? "var(--accent-color)" : "var(--danger-color)";
            
            document.getElementById('spyNameDisplay').innerText = state.players[state.spyIdx];
            document.getElementById('citizenWordDisplay').innerText = state.pkg.common;
            
            navTo('screen-result');
        }

        function showJudgement() {
            let context = "";
            let sourceList = [];

            if(state.spyCaught) {
                context = "Spy Caught! Choose a punishment:";
                sourceList = judgementsSpyLost;
            } else {
                context = "Spy Won! Choose a reward:";
                sourceList = judgementsSpyWon;
            }

            document.getElementById('judgeContext').innerText = context;
            
            // Get 3 random unique choices
            const shuffled = sourceList.sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 3);

            const listContainer = document.getElementById('judgementList');
            listContainer.innerHTML = '';

            selected.forEach(txt => {
                listContainer.innerHTML += `
                    <div class="judge-option arabic-text" onclick="this.classList.toggle('selected')">
                        ${txt}
                    </div>
                `;
            });

            navTo('screen-judgement');
        }

    </script>
</body>
</html>